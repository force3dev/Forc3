"use strict";(()=>{var e={};e.id=1658,e.ids=[1658,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49301:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var n={};r.r(n),r.d(n,{POST:()=>f,dynamic:()=>d});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),u=r(61165),c=r(63011),l=r(80213);let d="force-dynamic",p=new l.ZP;async function f(e){if(!await (0,u.getCurrentUserId)())return s.NextResponse.json({error:"Unauthorized"},{status:401});let{text:t}=await e.json();if(!t||t.length<3)return s.NextResponse.json({error:"Please describe what you ate"},{status:400});let r=await (0,c.GR)(t).catch(()=>[]);if(r.length>0){let e=r.reduce((e,t)=>({calories:e.calories+t.calories,protein:e.protein+t.protein,carbs:e.carbs+t.carbs,fat:e.fat+t.fat}),{calories:0,protein:0,carbs:0,fat:0});return s.NextResponse.json({foods:r.map(e=>({id:`nix_${e.name.replace(/\s/g,"_")}`,name:e.name,servingSize:`${e.servingQty} ${e.servingUnit}`,calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat,image:e.imageUrl,source:"nutritionix"})),totals:e,source:"nutritionix"})}let n=await p.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:1024,system:`You are a nutrition expert. When given a food description, return ONLY a JSON array of food items with estimated nutrition.
Format: [{"name": "...", "servingSize": "...", "calories": 0, "protein": 0, "carbs": 0, "fat": 0}]
Use common portion sizes. Be accurate but conservative with estimates. No markdown, just JSON.`,messages:[{role:"user",content:t}]});try{let e="text"===n.content[0].type?n.content[0].text:"[]",t=JSON.parse(e.trim()),r=t.reduce((e,t)=>({calories:e.calories+(t.calories||0),protein:e.protein+(t.protein||0),carbs:e.carbs+(t.carbs||0),fat:e.fat+(t.fat||0)}),{calories:0,protein:0,carbs:0,fat:0});return s.NextResponse.json({foods:t.map((e,t)=>({id:`ai_${t}_${e.name?.replace(/\s/g,"_")}`,name:e.name,servingSize:e.servingSize||"1 serving",calories:Math.round(e.calories||0),protein:Math.round(e.protein||0),carbs:Math.round(e.carbs||0),fat:Math.round(e.fat||0),source:"ai"})),totals:{calories:Math.round(r.calories),protein:Math.round(r.protein),carbs:Math.round(r.carbs),fat:Math.round(r.fat)},source:"ai"})}catch{return s.NextResponse.json({error:"Could not parse food description"},{status:422})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/nutrition/ai-log/route",pathname:"/api/nutrition/ai-log",filename:"route",bundlePath:"app/api/nutrition/ai-log/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\nutrition\\ai-log\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:_,serverHooks:h}=m,v="/api/nutrition/ai-log/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},95456:(e,t,r)=>{r.d(t,{AX:()=>d,Gg:()=>l,Rf:()=>p,ed:()=>u});var n=r(86890),a=r(41463),i=r(71615);let o=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),s="forc3_session";async function u(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(o)}async function c(e){try{let{payload:t}=await (0,a._)(e,o);return t}catch{return null}}async function l(){let e=await (0,i.cookies)(),t=e.get(s)?.value;return t?c(t):null}function d(e){return{name:s,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function p(){return{name:s,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},63011:(e,t,r)=>{r.d(t,{GR:()=>o,W1:()=>i,g:()=>s});let n="https://trackapi.nutritionix.com/v2";function a(){return{"x-app-id":process.env.NUTRITIONIX_APP_ID||"","x-app-key":process.env.NUTRITIONIX_API_KEY||"","Content-Type":"application/json"}}async function i(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let t=await fetch(`${n}/search/instant?query=${encodeURIComponent(e)}&self=false&branded=true&common=true&detailed=true`,{headers:a()});if(!t.ok)return[];let r=await t.json(),i=[];for(let e of(r.common||[]).slice(0,5))i.push({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.full_nutrients?.find(e=>208===e.attr_id)?.value||0),protein:Math.round(e.full_nutrients?.find(e=>203===e.attr_id)?.value||0),carbs:Math.round(e.full_nutrients?.find(e=>205===e.attr_id)?.value||0),fat:Math.round(e.full_nutrients?.find(e=>204===e.attr_id)?.value||0),imageUrl:e.photo?.thumb,source:"nutritionix"});for(let e of(r.branded||[]).slice(0,5))i.push({name:e.food_name,brandName:e.brand_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:e.nf_calories||0,protein:e.nf_protein||0,carbs:e.nf_total_carbohydrate||0,fat:e.nf_total_fat||0,fiber:e.nf_dietary_fiber,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"});return i}catch{return[]}}async function o(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let t=await fetch(`${n}/natural/nutrients`,{method:"POST",headers:a(),body:JSON.stringify({query:e})});if(!t.ok)return[];return((await t.json()).foods||[]).map(e=>({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.nf_calories||0),protein:Math.round(e.nf_protein||0),carbs:Math.round(e.nf_total_carbohydrate||0),fat:Math.round(e.nf_total_fat||0),fiber:e.nf_dietary_fiber,sugar:e.nf_sugars,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"}))}catch{return[]}}async function s(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return null;try{let t=await fetch(`${n}/search/item?upc=${e}`,{headers:a()});if(!t.ok)return null;let r=await t.json(),i=r.foods?.[0];if(!i)return null;return{name:i.food_name,brandName:i.brand_name,servingQty:i.serving_qty,servingUnit:i.serving_unit,servingWeightGrams:i.serving_weight_grams||100,calories:Math.round(i.nf_calories||0),protein:Math.round(i.nf_protein||0),carbs:Math.round(i.nf_total_carbohydrate||0),fat:Math.round(i.nf_total_fat||0),fiber:i.nf_dietary_fiber,sodium:i.nf_sodium,imageUrl:i.photo?.thumb,source:"nutritionix"}}catch{return null}}},13538:(e,t,r)=>{r.d(t,{prisma:()=>a});var n=r(53524);let a=globalThis.prisma||new n.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{getCurrentUserId:()=>a});var n=r(95456);async function a(){let e=await (0,n.Gg)();return e?.userId??null}r(13538)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,3112,213],()=>r(49301));module.exports=n})();