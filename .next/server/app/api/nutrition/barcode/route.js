"use strict";(()=>{var e={};e.id=8343,e.ids=[8343,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79193:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var n={};r.r(n),r.d(n,{GET:()=>f,dynamic:()=>l});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),u=r(61165),c=r(30732),d=r(63011);let l="force-dynamic";async function f(e){if(!await (0,u.getCurrentUserId)())return s.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=t.get("upc");if(!r||!/^\d{8,14}$/.test(r))return s.NextResponse.json({error:"Invalid barcode"},{status:400});let[n,a]=await Promise.allSettled([(0,d.g)(r),(0,c.v)(r)]),i="fulfilled"===n.status?n.value:null,o="fulfilled"===a.status?a.value:null;return i?s.NextResponse.json({food:{id:`nix_${r}`,name:i.name,brand:i.brandName,servingSize:`${i.servingQty} ${i.servingUnit}`,calories:i.calories,protein:i.protein,carbs:i.carbs,fat:i.fat,fiber:i.fiber,image:i.imageUrl,source:"nutritionix"}}):o?s.NextResponse.json({food:o}):s.NextResponse.json({error:"Product not found"},{status:404})}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/nutrition/barcode/route",pathname:"/api/nutrition/barcode",filename:"route",bundlePath:"app/api/nutrition/barcode/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\nutrition\\barcode\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:_,serverHooks:m}=p,h="/api/nutrition/barcode/route";function v(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}},95456:(e,t,r)=>{r.d(t,{AX:()=>l,Gg:()=>d,Rf:()=>f,ed:()=>u});var n=r(86890),a=r(41463),i=r(71615);let o=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),s="forc3_session";async function u(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(o)}async function c(e){try{let{payload:t}=await (0,a._)(e,o);return t}catch{return null}}async function d(){let e=await (0,i.cookies)(),t=e.get(s)?.value;return t?c(t):null}function l(e){return{name:s,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function f(){return{name:s,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},30732:(e,t,r)=>{r.d(t,{d:()=>a,v:()=>i});let n="https://world.openfoodfacts.org";async function a(e){let t=`${n}/cgi/search.pl?search_terms=${encodeURIComponent(e)}&search_simple=1&action=process&json=1&page_size=20&fields=code,product_name,brands,nutriments,image_small_url,serving_size`,r=await fetch(t,{headers:{"User-Agent":"FORC3-App/1.0 (contact@forc3.app)"},signal:AbortSignal.timeout(5e3)});return((await r.json()).products||[]).filter(e=>{let t=e.nutriments;return t&&(t["energy-kcal_100g"]||t["energy-kcal"])}).map(e=>{let t=e.nutriments;return{id:`off_${e.code}`,name:e.product_name||"Unknown",brand:e.brands,servingSize:e.serving_size||"100g",calories:Math.round(t["energy-kcal_100g"]||t["energy-kcal"]||0),protein:Math.round(t.proteins_100g||t.proteins||0),carbs:Math.round(t.carbohydrates_100g||t.carbohydrates||0),fat:Math.round(t.fat_100g||t.fat||0),fiber:Math.round(t.fiber_100g||t.fiber||0),image:e.image_small_url,source:"openfoodfacts"}}).slice(0,12)}async function i(e){let t=await fetch(`${n}/api/v0/product/${e}.json`,{headers:{"User-Agent":"FORC3-App/1.0 (contact@forc3.app)"},signal:AbortSignal.timeout(5e3)}),r=await t.json();if(1!==r.status)return null;let a=r.product,i=a.nutriments||{};return{id:`off_${a.code}`,name:a.product_name||"Unknown",brand:a.brands,servingSize:a.serving_size||"100g",calories:Math.round(i["energy-kcal_100g"]||0),protein:Math.round(i.proteins_100g||0),carbs:Math.round(i.carbohydrates_100g||0),fat:Math.round(i.fat_100g||0),fiber:Math.round(i.fiber_100g||0),image:a.image_small_url,source:"openfoodfacts"}}},63011:(e,t,r)=>{r.d(t,{GR:()=>o,W1:()=>i,g:()=>s});let n="https://trackapi.nutritionix.com/v2";function a(){return{"x-app-id":process.env.NUTRITIONIX_APP_ID||"","x-app-key":process.env.NUTRITIONIX_API_KEY||"","Content-Type":"application/json"}}async function i(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let t=await fetch(`${n}/search/instant?query=${encodeURIComponent(e)}&self=false&branded=true&common=true&detailed=true`,{headers:a()});if(!t.ok)return[];let r=await t.json(),i=[];for(let e of(r.common||[]).slice(0,5))i.push({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.full_nutrients?.find(e=>208===e.attr_id)?.value||0),protein:Math.round(e.full_nutrients?.find(e=>203===e.attr_id)?.value||0),carbs:Math.round(e.full_nutrients?.find(e=>205===e.attr_id)?.value||0),fat:Math.round(e.full_nutrients?.find(e=>204===e.attr_id)?.value||0),imageUrl:e.photo?.thumb,source:"nutritionix"});for(let e of(r.branded||[]).slice(0,5))i.push({name:e.food_name,brandName:e.brand_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:e.nf_calories||0,protein:e.nf_protein||0,carbs:e.nf_total_carbohydrate||0,fat:e.nf_total_fat||0,fiber:e.nf_dietary_fiber,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"});return i}catch{return[]}}async function o(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let t=await fetch(`${n}/natural/nutrients`,{method:"POST",headers:a(),body:JSON.stringify({query:e})});if(!t.ok)return[];return((await t.json()).foods||[]).map(e=>({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.nf_calories||0),protein:Math.round(e.nf_protein||0),carbs:Math.round(e.nf_total_carbohydrate||0),fat:Math.round(e.nf_total_fat||0),fiber:e.nf_dietary_fiber,sugar:e.nf_sugars,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"}))}catch{return[]}}async function s(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return null;try{let t=await fetch(`${n}/search/item?upc=${e}`,{headers:a()});if(!t.ok)return null;let r=await t.json(),i=r.foods?.[0];if(!i)return null;return{name:i.food_name,brandName:i.brand_name,servingQty:i.serving_qty,servingUnit:i.serving_unit,servingWeightGrams:i.serving_weight_grams||100,calories:Math.round(i.nf_calories||0),protein:Math.round(i.nf_protein||0),carbs:Math.round(i.nf_total_carbohydrate||0),fat:Math.round(i.nf_total_fat||0),fiber:i.nf_dietary_fiber,sodium:i.nf_sodium,imageUrl:i.photo?.thumb,source:"nutritionix"}}catch{return null}}},13538:(e,t,r)=>{r.d(t,{prisma:()=>a});var n=r(53524);let a=globalThis.prisma||new n.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{getCurrentUserId:()=>a});var n=r(95456);async function a(){let e=await (0,n.Gg)();return e?.userId??null}r(13538)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,3112],()=>r(79193));module.exports=n})();