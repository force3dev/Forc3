"use strict";(()=>{var e={};e.id=2937,e.ids=[2937,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20325:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h});var n={};t.r(n),t.d(n,{GET:()=>g,dynamic:()=>p});var a=t(49303),i=t(88716),o=t(60670),s=t(87070),u=t(61165),c=t(30732);async function d(e){let r=process.env.USDA_API_KEY||"DEMO_KEY",t=`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${r}&query=${encodeURIComponent(e)}&pageSize=15&dataType=Foundation,SR%20Legacy,Branded`,n=await fetch(t,{signal:AbortSignal.timeout(5e3)});if(!n.ok)return[];let a=await n.json(),i=(e,r)=>e.find(e=>e.nutrientName===r)?.value||0;return(a.foods||[]).map(e=>({id:`usda_${e.fdcId}`,name:e.description,brand:e.brandOwner,servingSize:e.servingSize?`${e.servingSize}${e.servingSizeUnit||"g"}`:"100g",calories:Math.round(i(e.foodNutrients,"Energy")),protein:Math.round(i(e.foodNutrients,"Protein")),carbs:Math.round(i(e.foodNutrients,"Carbohydrate, by difference")),fat:Math.round(i(e.foodNutrients,"Total lipid (fat)")),fiber:Math.round(i(e.foodNutrients,"Fiber, total dietary")),source:"usda"}))}var l=t(63011);async function f(e){let r=process.env.EDAMAM_FOOD_APP_ID,t=process.env.EDAMAM_FOOD_APP_KEY;if(!r||!t)return[];try{let n=`https://api.edamam.com/api/food-database/v2/parser?app_id=${r}&app_key=${t}&ingr=${encodeURIComponent(e)}&nutrition-type=logging`,a=await fetch(n,{next:{revalidate:3600}});if(!a.ok)return[];return((await a.json()).hints||[]).slice(0,8).map(e=>{let r=e.food,t=r.nutrients||{};return{name:r.label,brandName:r.brand,servingQty:1,servingUnit:"serving",servingWeightGrams:100,calories:Math.round(t.ENERC_KCAL||0),protein:Math.round(t.PROCNT||0),carbs:Math.round(t.CHOCDF||0),fat:Math.round(t.FAT||0),fiber:t.FIBTG?Math.round(t.FIBTG):void 0,imageUrl:r.image,source:"edamam"}})}catch{return[]}}let p="force-dynamic";async function g(e){if(!await (0,u.getCurrentUserId)())return s.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),t=r.get("q");if(!t||t.length<2)return s.NextResponse.json({results:[]});let[n,a,i,o]=await Promise.all([(0,c.d)(t).catch(()=>[]),d(t).catch(()=>[]),(0,l.W1)(t).catch(()=>[]),f(t).catch(()=>[])]),p=[...a,...i.map(e=>({id:`nix_${e.name.replace(/\s/g,"_")}`,name:e.name,brand:e.brandName,servingSize:`${e.servingQty} ${e.servingUnit}`,calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat,fiber:e.fiber,image:e.imageUrl,source:"nutritionix"})),...n,...o.map(e=>({id:`edamam_${e.name.replace(/\s/g,"_")}`,name:e.name,brand:e.brandName,servingSize:"100g",calories:e.calories,protein:e.protein,carbs:e.carbs,fat:e.fat,fiber:e.fiber,image:e.imageUrl,source:"edamam"}))],g=t.toLowerCase();p.sort((e,r)=>{let t=e.name.toLowerCase().startsWith(g),n=r.name.toLowerCase().startsWith(g),a=e.name.toLowerCase().includes(g),i=r.name.toLowerCase().includes(g);return t&&!n?-1:n&&!t?1:a&&!i?-1:i&&!a?1:0});let m=p.filter(e=>e.calories>0);return s.NextResponse.json({results:m.slice(0,20)})}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/nutrition/search/route",pathname:"/api/nutrition/search",filename:"route",bundlePath:"app/api/nutrition/search/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\nutrition\\search\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:v}=m,b="/api/nutrition/search/route";function y(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}},95456:(e,r,t)=>{t.d(r,{AX:()=>l,Gg:()=>d,Rf:()=>f,ed:()=>u});var n=t(86890),a=t(41463),i=t(71615);let o=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),s="forc3_session";async function u(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(o)}async function c(e){try{let{payload:r}=await (0,a._)(e,o);return r}catch{return null}}async function d(){let e=await (0,i.cookies)(),r=e.get(s)?.value;return r?c(r):null}function l(e){return{name:s,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function f(){return{name:s,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},30732:(e,r,t)=>{t.d(r,{d:()=>a,v:()=>i});let n="https://world.openfoodfacts.org";async function a(e){let r=`${n}/cgi/search.pl?search_terms=${encodeURIComponent(e)}&search_simple=1&action=process&json=1&page_size=20&fields=code,product_name,brands,nutriments,image_small_url,serving_size`,t=await fetch(r,{headers:{"User-Agent":"FORC3-App/1.0 (contact@forc3.app)"},signal:AbortSignal.timeout(5e3)});return((await t.json()).products||[]).filter(e=>{let r=e.nutriments;return r&&(r["energy-kcal_100g"]||r["energy-kcal"])}).map(e=>{let r=e.nutriments;return{id:`off_${e.code}`,name:e.product_name||"Unknown",brand:e.brands,servingSize:e.serving_size||"100g",calories:Math.round(r["energy-kcal_100g"]||r["energy-kcal"]||0),protein:Math.round(r.proteins_100g||r.proteins||0),carbs:Math.round(r.carbohydrates_100g||r.carbohydrates||0),fat:Math.round(r.fat_100g||r.fat||0),fiber:Math.round(r.fiber_100g||r.fiber||0),image:e.image_small_url,source:"openfoodfacts"}}).slice(0,12)}async function i(e){let r=await fetch(`${n}/api/v0/product/${e}.json`,{headers:{"User-Agent":"FORC3-App/1.0 (contact@forc3.app)"},signal:AbortSignal.timeout(5e3)}),t=await r.json();if(1!==t.status)return null;let a=t.product,i=a.nutriments||{};return{id:`off_${a.code}`,name:a.product_name||"Unknown",brand:a.brands,servingSize:a.serving_size||"100g",calories:Math.round(i["energy-kcal_100g"]||0),protein:Math.round(i.proteins_100g||0),carbs:Math.round(i.carbohydrates_100g||0),fat:Math.round(i.fat_100g||0),fiber:Math.round(i.fiber_100g||0),image:a.image_small_url,source:"openfoodfacts"}}},63011:(e,r,t)=>{t.d(r,{GR:()=>o,W1:()=>i,g:()=>s});let n="https://trackapi.nutritionix.com/v2";function a(){return{"x-app-id":process.env.NUTRITIONIX_APP_ID||"","x-app-key":process.env.NUTRITIONIX_API_KEY||"","Content-Type":"application/json"}}async function i(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let r=await fetch(`${n}/search/instant?query=${encodeURIComponent(e)}&self=false&branded=true&common=true&detailed=true`,{headers:a()});if(!r.ok)return[];let t=await r.json(),i=[];for(let e of(t.common||[]).slice(0,5))i.push({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.full_nutrients?.find(e=>208===e.attr_id)?.value||0),protein:Math.round(e.full_nutrients?.find(e=>203===e.attr_id)?.value||0),carbs:Math.round(e.full_nutrients?.find(e=>205===e.attr_id)?.value||0),fat:Math.round(e.full_nutrients?.find(e=>204===e.attr_id)?.value||0),imageUrl:e.photo?.thumb,source:"nutritionix"});for(let e of(t.branded||[]).slice(0,5))i.push({name:e.food_name,brandName:e.brand_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:e.nf_calories||0,protein:e.nf_protein||0,carbs:e.nf_total_carbohydrate||0,fat:e.nf_total_fat||0,fiber:e.nf_dietary_fiber,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"});return i}catch{return[]}}async function o(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return[];try{let r=await fetch(`${n}/natural/nutrients`,{method:"POST",headers:a(),body:JSON.stringify({query:e})});if(!r.ok)return[];return((await r.json()).foods||[]).map(e=>({name:e.food_name,servingQty:e.serving_qty,servingUnit:e.serving_unit,servingWeightGrams:e.serving_weight_grams||100,calories:Math.round(e.nf_calories||0),protein:Math.round(e.nf_protein||0),carbs:Math.round(e.nf_total_carbohydrate||0),fat:Math.round(e.nf_total_fat||0),fiber:e.nf_dietary_fiber,sugar:e.nf_sugars,sodium:e.nf_sodium,imageUrl:e.photo?.thumb,source:"nutritionix"}))}catch{return[]}}async function s(e){if(!process.env.NUTRITIONIX_APP_ID||!process.env.NUTRITIONIX_API_KEY)return null;try{let r=await fetch(`${n}/search/item?upc=${e}`,{headers:a()});if(!r.ok)return null;let t=await r.json(),i=t.foods?.[0];if(!i)return null;return{name:i.food_name,brandName:i.brand_name,servingQty:i.serving_qty,servingUnit:i.serving_unit,servingWeightGrams:i.serving_weight_grams||100,calories:Math.round(i.nf_calories||0),protein:Math.round(i.nf_protein||0),carbs:Math.round(i.nf_total_carbohydrate||0),fat:Math.round(i.nf_total_fat||0),fiber:i.nf_dietary_fiber,sodium:i.nf_sodium,imageUrl:i.photo?.thumb,source:"nutritionix"}}catch{return null}}},13538:(e,r,t)=>{t.d(r,{prisma:()=>a});var n=t(53524);let a=globalThis.prisma||new n.PrismaClient({log:["warn","error"]})},61165:(e,r,t)=>{t.d(r,{getCurrentUserId:()=>a});var n=t(95456);async function a(){let e=await (0,n.Gg)();return e?.userId??null}t(13538)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[8948,5972,3112],()=>t(20325));module.exports=n})();