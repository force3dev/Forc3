"use strict";(()=>{var e={};e.id=2937,e.ids=[2937],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},95282:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>p,dynamic:()=>l});var a=r(49303),s=r(88716),o=r(60670),i=r(87070),c=r(61165);async function u(e){let t=`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(e)}&search_simple=1&action=process&json=1&page_size=20&fields=code,product_name,brands,nutriments,image_small_url,serving_size`,r=await fetch(t,{headers:{"User-Agent":"FORC3-App/1.0 (contact@forc3.app)"},signal:AbortSignal.timeout(5e3)});return((await r.json()).products||[]).filter(e=>{let t=e.nutriments;return t&&(t["energy-kcal_100g"]||t["energy-kcal"])}).map(e=>{let t=e.nutriments;return{id:`off_${e.code}`,name:e.product_name||"Unknown",brand:e.brands,servingSize:e.serving_size||"100g",calories:Math.round(t["energy-kcal_100g"]||t["energy-kcal"]||0),protein:Math.round(t.proteins_100g||t.proteins||0),carbs:Math.round(t.carbohydrates_100g||t.carbohydrates||0),fat:Math.round(t.fat_100g||t.fat||0),fiber:Math.round(t.fiber_100g||t.fiber||0),image:e.image_small_url,source:"openfoodfacts"}}).slice(0,12)}async function d(e){let t=process.env.USDA_API_KEY||"DEMO_KEY",r=`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${t}&query=${encodeURIComponent(e)}&pageSize=15&dataType=Foundation,SR%20Legacy,Branded`,n=await fetch(r,{signal:AbortSignal.timeout(5e3)});if(!n.ok)return[];let a=await n.json(),s=(e,t)=>e.find(e=>e.nutrientName===t)?.value||0;return(a.foods||[]).map(e=>({id:`usda_${e.fdcId}`,name:e.description,brand:e.brandOwner,servingSize:e.servingSize?`${e.servingSize}${e.servingSizeUnit||"g"}`:"100g",calories:Math.round(s(e.foodNutrients,"Energy")),protein:Math.round(s(e.foodNutrients,"Protein")),carbs:Math.round(s(e.foodNutrients,"Carbohydrate, by difference")),fat:Math.round(s(e.foodNutrients,"Total lipid (fat)")),fiber:Math.round(s(e.foodNutrients,"Fiber, total dietary")),source:"usda"}))}let l="force-dynamic";async function p(e){if(!await (0,c.rc)())return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=t.get("q");if(!r||r.length<2)return i.NextResponse.json({results:[]});let[n,a]=await Promise.all([u(r).catch(()=>[]),d(r).catch(()=>[])]),s=[...a,...n],o=r.toLowerCase();s.sort((e,t)=>{let r=e.name.toLowerCase().startsWith(o),n=t.name.toLowerCase().startsWith(o),a=e.name.toLowerCase().includes(o),s=t.name.toLowerCase().includes(o);return r&&!n?-1:n&&!r?1:a&&!s?-1:s&&!a?1:0});let l=s.filter(e=>e.calories>0);return i.NextResponse.json({results:l.slice(0,20)})}let g=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/nutrition/search/route",pathname:"/api/nutrition/search",filename:"route",bundlePath:"app/api/nutrition/search/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\nutrition\\search\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:h}=g,y="/api/nutrition/search/route";function _(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},95456:(e,t,r)=>{r.d(t,{AX:()=>l,Gg:()=>d,Rf:()=>p,ed:()=>c});var n=r(86890),a=r(41463),s=r(71615);let o=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),i="forc3_session";async function c(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(o)}async function u(e){try{let{payload:t}=await (0,a._)(e,o);return t}catch{return null}}async function d(){let e=await (0,s.cookies)(),t=e.get(i)?.value;return t?u(t):null}function l(e){return{name:i,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function p(){return{name:i,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},20728:(e,t,r)=>{r.d(t,{_:()=>a});let n=require("@prisma/client"),a=globalThis.prisma||new n.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{rc:()=>a});var n=r(95456);async function a(){let e=await (0,n.Gg)();return e?.userId??null}r(20728)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,3112],()=>r(95282));module.exports=n})();