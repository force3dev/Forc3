"use strict";(()=>{var e={};e.id=5871,e.ids=[5871],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},34137:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>k,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var r={};n.r(r),n.d(r,{GET:()=>g,dynamic:()=>h});var i=n(49303),a=n(88716),s=n(60670),o=n(87070),l=n(61165),d=n(13538),c=n(80213),u=n(77265);let h="force-dynamic";function p(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}async function g(){let e=await (0,l.getCurrentUserId)();if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});let[t,n]=await Promise.all([d.prisma.profile.findUnique({where:{userId:e}}),d.prisma.subscription.findUnique({where:{userId:e}})]);if(n?.morningCheckinMessage&&n?.morningCheckinDate&&p(new Date,n.morningCheckinDate))return o.NextResponse.json({message:n.morningCheckinMessage,cached:!0});if(!process.env.CLAUDE_API_KEY)return o.NextResponse.json({message:"Good morning! Today's plan is ready. Let's get after it. \uD83D\uDCAA",cached:!1});let r="Rest day",i="No cardio today",a="",s="";if(t){let e=Array.isArray(t.raceGoals)?t.raceGoals:[],n=(0,u.dd)({goal:t.goal||"general",experienceLevel:t.experienceLevel||"intermediate",trainingDays:t.trainingDays||4,sport:t.sport||void 0,raceGoals:e,trainingVolume:t.trainingVolume||"intermediate"}),o=new Date().getDay(),l=0===o?6:o-1,d=n.days.find(e=>e.dayIndex===l);d?.strengthLabel&&(r=d.strengthLabel+" lift");let c=(0,u.$I)(n);if(c&&(i=c.title+" ("+c.duration+" min, "+c.intensity+")"),e.length>0){let t=e.filter(e=>e.date).map(e=>({type:e.type,days:Math.max(0,Math.round((new Date(e.date).getTime()-Date.now())/864e5))})).sort((e,t)=>e.days-t.days)[0];t&&(a=t.days+" days",s=t.type.replace(/_/g," "))}}let h=new c.ZP({apiKey:process.env.CLAUDE_API_KEY}),g=`You are a world-class hybrid athlete coach. Deliver a personalized morning training brief. Be direct, motivating, specific. Under 100 words. Sound like a real coach.

Name: ${t?.name||"Athlete"}
Today's workout: ${r}
Today's cardio: ${i}
${a?"Days until race: "+a:""}
${s?"Race goal: "+s:""}

Generate a morning check-in that:
1. Acknowledges today's specific training
2. Gives one key coaching cue
3. Ends with a short motivating statement
Keep it punchy. No fluff.`;try{let t=await h.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:200,messages:[{role:"user",content:g}]}),r="text"===t.content[0].type?t.content[0].text:"Let's get after it today!",i=new Date,a=n&&p(i,n.aiMessagesResetAt)?n.aiMessagesUsedToday:0;return n?await d.prisma.subscription.update({where:{userId:e},data:{morningCheckinMessage:r,morningCheckinDate:i,aiMessagesUsedToday:a+1}}):await d.prisma.subscription.create({data:{userId:e,tier:"free",status:"active",morningCheckinMessage:r,morningCheckinDate:i,aiMessagesUsedToday:1,aiMessagesResetAt:i}}),o.NextResponse.json({message:r,cached:!1})}catch{return o.NextResponse.json({message:"Good morning! Today's plan is locked and loaded. Let's go. \uD83D\uDCAA",cached:!1})}}let y=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/coach/morning-checkin/route",pathname:"/api/coach/morning-checkin",filename:"route",bundlePath:"app/api/coach/morning-checkin/route"},resolvedPagePath:"/home/runner/work/Forc3/Forc3/src/app/api/coach/morning-checkin/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:w}=y,k="/api/coach/morning-checkin/route";function v(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},77265:(e,t,n)=>{n.d(t,{$I:()=>c,dd:()=>d,ps:()=>u});var r=n(62643);function i(e){let t=r.zr.find(t=>t.id===e);if(!t)throw Error(`Cardio template not found: ${e}`);return t}function a(e){return{templateId:e.id,title:e.title,type:e.type,duration:e.duration,intensity:e.intensity}}function s(e,t){if(0===t)return!1;let n=e[t-1];return n.hasStrength&&!!n.strengthLabel&&/legs|lower|full/i.test(n.strengthLabel)}function o(e,t,n){let r=Array(7).fill(null);if(t>=6){let e=["Push A","Pull A","Legs A","Push B","Pull B","Legs B"];for(let t=0;t<6;t++)r[t]=e[t]}else if(5===t)r[0]="Push",r[1]="Pull",r[2]="Legs",r[3]="Upper",r[4]="Full Body";else if(4===t){r[0]="Upper A",r[2]="Lower A",r[3]="Upper B",r[5]="Lower B";let e=["Upper A","Lower A","Upper B","Lower B"];r.fill(null),[0,1,3,4].forEach((t,n)=>{r[t]=e[n]})}else 3===t?(r[0]="Full Body A",r[2]="Full Body B",r[4]="Full Body C"):2===t&&(r[0]="Upper",r[3]="Lower");return n.isPowerlifter&&r[5],r}let l=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function d(e){let t,n,d;let c=function(e){let{sport:t,raceGoals:n}=e,r=n||[],i="triathlon"===t||r.some(e=>["sprint_tri","olympic_tri","half_ironman","full_ironman"].includes(e.type)),a="running"===t||r.some(e=>["5k_10k","half_marathon","full_marathon"].includes(e.type)),s="swimming"===t||r.some(e=>"swim_race"===e.type),o="cycling"===t||r.some(e=>"cycling_race"===e.type),l=r.some(e=>"ocr"===e.type),d=r.some(e=>"powerlifting"===e.type),c=Date.now(),u=r.filter(e=>e.date).map(e=>Math.max(0,Math.round((new Date(e.date).getTime()-c)/6048e5))),h=u.length>0?Math.min(...u):null,p="general";return i?p="triathlete":a?p="runner":s?p="swimmer":o?p="cyclist":l?p="ocr":t&&(p=t),{isTriathlete:i,isRunner:a,isSwimmer:s,isCyclist:o,isOCR:l,isPowerlifter:d,primarySport:p,weeksToRace:h,inTaper:null!==h&&h<=3,raceApproaching:null!==h&&h<=6}}(e),u=Math.min(e.trainingDays,5),h=function(e,t){let n=e.trainingVolume||"intermediate";return t.isTriathlete||t.isRunner?"advanced"===n?5:"intermediate"===n?4:3:t.isSwimmer||t.isCyclist?"advanced"===n?4:3:"endurance"===e.goal?4:"fat_loss"===e.goal?3:2}(e,c);c.isTriathlete?(t=function(e,t,n,r){let s=o(7,n,t),d=t.inTaper,c={0:a(i("run-easy")),1:a(i("swim-drills")),2:a(d?i("run-easy"):i("run-tempo")),3:a(d?i("bike-recovery"):i("bike-endurance")),4:a(i("swim-pull")),5:a(d?i("run-easy"):i("run-long")),6:null};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:c[t]||void 0,isRest:6===t,note:6===t?"Rest & recovery":d&&[3,5].includes(t)?"Taper week — keep intensity low":void 0}))}(0,c,u,0),n="triathlete",d=c.inTaper?"Taper week — reducing volume ahead of race":"Triathlon hybrid: swim, bike, run + strength"):c.isRunner?(t=function(e,t,n,r){let s=o(7,n,t),d=t.inTaper,c={0:a(i("run-easy")),1:a(d?i("run-easy"):i("run-400-intervals")),2:a(i("run-easy")),3:a(d?i("run-easy"):i("run-tempo")),4:a(i("run-easy")),5:a(d?i("run-easy"):i("run-long")),6:null};return r<5&&delete c[4],r<4&&delete c[2],l.map((e,n)=>({day:e,dayIndex:n,hasStrength:!!s[n],strengthLabel:s[n]||void 0,cardio:c[n]||void 0,isRest:6===n&&!c[6],note:t.raceApproaching&&5===n?"Key long run — race simulation pace":void 0}))}(0,c,u,h),n="runner",d=c.raceApproaching?"Race-specific run build + strength support":"Running hybrid: aerobic base + speed work + strength"):c.isSwimmer?(t=function(e,t,n,r){let s=o(7,n,t),d=t.inTaper,c={0:a(i("swim-drills")),1:null,2:a(d?i("swim-endurance"):i("swim-pull")),3:a(d?i("swim-drills"):i("swim-sprints")),4:a(i("swim-kick")),5:a(i("swim-endurance")),6:null};return r<4&&delete c[4],l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:c[t]||void 0,isRest:!c[t]&&!s[t]}))}(0,c,u,h),n="swimmer",d="Swimming hybrid: technique + strength + endurance"):c.isCyclist?(t=function(e,t,n,r){let s=o(7,n,t),d=t.inTaper,c={0:a(i("bike-recovery")),1:null,2:a(d?i("bike-recovery"):i("bike-threshold")),3:a(i("bike-endurance")),4:null,5:a(i("bike-endurance")),6:null};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:c[t]||void 0,isRest:!c[t]&&!s[t],note:5===t?"Long ride — aim for 60–90 min":void 0}))}(0,c,u,0),n="cyclist",d="Cycling hybrid: threshold + endurance + strength"):"endurance"===e.goal?(t=function(e,t){let n=o(7,t,{isTriathlete:!1}),r={0:a(i("run-easy")),1:null,2:a(i("run-800-repeats")),3:a(i("bike-endurance")),4:null,5:a(i("run-long")),6:a(i("bike-recovery"))};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!n[t],strengthLabel:n[t]||void 0,cardio:r[t]||void 0,isRest:!r[t]&&!n[t]}))}(0,u),n="endurance",d="Endurance-focused hybrid: aerobic volume + strength maintenance"):(t=function(e,t,n){let r=o(7,t,{}),d=[a(i("run-fartlek")),a(i("hiit-jump-rope-tabata")),a(i("row-steady-state")),a(i("bike-recovery")),a(i("run-easy"))],c=l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!r[t],strengthLabel:r[t]||void 0,cardio:void 0,isRest:!1})),u=0,h=[...d];for(let e=0;e<7&&u<n;e++)!c[e].hasStrength&&6!==e&&(s(c,e)?c[e].cardio=a(i("bike-recovery")):c[e].cardio=h[u%h.length],u++);return c.forEach(e=>{e.isRest=!e.hasStrength&&!e.cardio}),c}(0,u,h),n="general",d="General hybrid: strength-primary with cardio for conditioning");let p=(t=function(e){for(let t=0;t<e.length;t++){let n=e[t].cardio;if(n){if(function(e,t){let n=0;for(let r=t-1;r>=0;r--){let t=e[r].cardio;if(t&&("hard"===t.intensity||"max"===t.intensity))n++;else break}return n}(e,t)>=2&&("hard"===n.intensity||"max"===n.intensity)){let i=r.zr.find(e=>e.type===n.type&&"easy"===e.intensity)||r.zr.find(e=>"easy"===e.intensity);i&&(e[t].cardio=a(i),e[t].note=(e[t].note?e[t].note+" \xb7 ":"")+"Intensity reduced — recovery day")}if(s(e,t)&&"hard"===n.intensity){let s=r.zr.find(e=>e.type===n.type&&"easy"===e.intensity)||i("bike-recovery");e[t].cardio=a(s),e[t].note=(e[t].note?e[t].note+" \xb7 ":"")+"Easy cardio — recovery after heavy lift"}}}return e}(t)).reduce((e,t)=>e+(t.cardio?.duration||0),0),g=t.filter(e=>e.hasStrength).length;return{days:t,weeklyCardioMinutes:p,weeklyLiftDays:g,programType:n,description:d}}function c(e){let t=new Date().getDay(),n=0===t?6:t-1,r=e.days.find(e=>e.dayIndex===n);return r?.cardio||null}function u(e){let t=e.days.map(e=>{let t=[];return e.hasStrength&&t.push(`Lift (${e.strengthLabel})`),e.cardio&&t.push(`${e.cardio.title} [${e.cardio.intensity}]`),e.isRest&&0===t.length&&t.push("Rest"),`${e.day}: ${t.join(" + ")}`});return[`Program: ${e.description}`,`Weekly cardio: ${e.weeklyCardioMinutes} min | Lift days: ${e.weeklyLiftDays}`,"",...t].join("\n")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972,3112,213,1679],()=>n(34137));module.exports=r})();