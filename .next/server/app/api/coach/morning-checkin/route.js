"use strict";(()=>{var e={};e.id=5871,e.ids=[5871],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},97009:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w});var r={};n.r(r),n.d(r,{GET:()=>y,dynamic:()=>h});var a=n(49303),i=n(88716),s=n(60670),o=n(87070),l=n(61165),c=n(13538),d=n(80213),u=n(77265);let h="force-dynamic";function g(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}async function p(e,t){let[n,r]=await Promise.all([c.prisma.profile.findUnique({where:{userId:e}}),c.prisma.workoutLog.findFirst({where:{userId:e,completedAt:{not:null}},orderBy:{completedAt:"desc"},include:{workout:{select:{name:!0}}}})]);if(!r?.completedAt)return{show:!1,message:"",daysSince:0};let a=Math.floor((Date.now()-new Date(r.completedAt).getTime())/864e5);if(a<2)return{show:!1,message:"",daysSince:a};let i=n?.name?.split(" ")[0]||"Athlete",s=n?.goal?.replace(/_/g," ")||"your goal",o=(Array.isArray(n?.raceGoals)?n.raceGoals:[]).filter(e=>e.date).map(e=>({type:e.type,days:Math.max(0,Math.round((new Date(e.date).getTime()-Date.now())/864e5))})).sort((e,t)=>e.days-t.days)[0],l=`${i} missed their last ${a} days of training.
Last workout was: ${r.workout?.name||"a workout"}
Their current goal: ${s}
${o?`Race in ${o.days} days: ${o.type?.replace(/_/g," ")}`:""}

Write a brief, human check-in message (2-3 sentences max).
Be understanding, not preachy. Acknowledge life happens.
Suggest getting back on track with something manageable today.
Don't guilt trip. Be real and warm. Sound like Coach Alex.`;try{let e=await t.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:150,messages:[{role:"user",content:l}]}),n="text"===e.content[0].type?e.content[0].text:"";return{show:!0,message:n,daysSince:a}}catch{return{show:!0,message:`Hey ${i} — life gets busy, I get it. Let's get back on track today with something manageable. Even a 20-minute session counts.`,daysSince:a}}}async function y(e){let{searchParams:t}=new URL(e.url),n="missed"===t.get("check"),r=await (0,l.getCurrentUserId)();if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let a=process.env.CLAUDE_API_KEY?new d.ZP({apiKey:process.env.CLAUDE_API_KEY}):null;if(n)return a?o.NextResponse.json(await p(r,a)):o.NextResponse.json({show:!1,message:"",daysSince:0});let[i,s]=await Promise.all([c.prisma.profile.findUnique({where:{userId:r}}),c.prisma.subscription.findUnique({where:{userId:r}})]);if(s?.morningCheckinMessage&&s?.morningCheckinDate&&g(new Date,s.morningCheckinDate))return o.NextResponse.json({message:s.morningCheckinMessage,cached:!0});if(!a)return o.NextResponse.json({message:"Good morning! Today's plan is ready. Let's get after it. \uD83D\uDCAA",cached:!1});let h="Rest day",y="No cardio today",m="",f="";if(i){let e=Array.isArray(i.raceGoals)?i.raceGoals:[],t=(0,u.dd)({goal:i.goal||"general",experienceLevel:i.experienceLevel||"intermediate",trainingDays:i.trainingDays||4,sport:i.sport||void 0,raceGoals:e,trainingVolume:i.trainingVolume||"intermediate"}),n=new Date().getDay(),r=0===n?6:n-1,a=t.days.find(e=>e.dayIndex===r);a?.strengthLabel&&(h=a.strengthLabel+" lift");let s=(0,u.$I)(t);if(s&&(y=s.title+" ("+s.duration+" min, "+s.intensity+")"),e.length>0){let t=e.filter(e=>e.date).map(e=>({type:e.type,days:Math.max(0,Math.round((new Date(e.date).getTime()-Date.now())/864e5))})).sort((e,t)=>e.days-t.days)[0];t&&(m=t.days+" days",f=t.type.replace(/_/g," "))}}let w=new d.ZP({apiKey:process.env.CLAUDE_API_KEY}),k=`You are Coach Alex — a world-class hybrid athlete coach. Deliver a personalized morning training brief. Be direct, motivating, specific. Under 100 words. Sound like a real coach, not a bot.

Name: ${i?.name||"Athlete"}
Today's workout: ${h}
Today's cardio: ${y}
${m?"Days until race: "+m:""}
${f?"Race goal: "+f:""}

Generate a morning check-in that:
1. Acknowledges today's specific training
2. Gives one key coaching cue
3. Ends with a short motivating statement
Keep it punchy. No fluff.`;try{let e=await w.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:200,messages:[{role:"user",content:k}]}),t="text"===e.content[0].type?e.content[0].text:"Let's get after it today!",n=new Date,a=s&&g(n,s.aiMessagesResetAt)?s.aiMessagesUsedToday:0;return s?await c.prisma.subscription.update({where:{userId:r},data:{morningCheckinMessage:t,morningCheckinDate:n,aiMessagesUsedToday:a+1}}):await c.prisma.subscription.create({data:{userId:r,tier:"free",status:"active",morningCheckinMessage:t,morningCheckinDate:n,aiMessagesUsedToday:1,aiMessagesResetAt:n}}),o.NextResponse.json({message:t,cached:!1})}catch{return o.NextResponse.json({message:"Good morning! Today's plan is locked and loaded. Let's go. \uD83D\uDCAA",cached:!1})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/coach/morning-checkin/route",pathname:"/api/coach/morning-checkin",filename:"route",bundlePath:"app/api/coach/morning-checkin/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\coach\\morning-checkin\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:k}=m,v="/api/coach/morning-checkin/route";function b(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:w})}},77265:(e,t,n)=>{n.d(t,{$I:()=>d,dd:()=>c,ps:()=>u});var r=n(62643);function a(e){let t=r.zr.find(t=>t.id===e);if(!t)throw Error(`Cardio template not found: ${e}`);return t}function i(e){return{templateId:e.id,title:e.title,type:e.type,duration:e.duration,intensity:e.intensity}}function s(e,t){if(0===t)return!1;let n=e[t-1];return n.hasStrength&&!!n.strengthLabel&&/legs|lower|full/i.test(n.strengthLabel)}function o(e,t,n){let r=Array(7).fill(null);if(t>=6){let e=["Push A","Pull A","Legs A","Push B","Pull B","Legs B"];for(let t=0;t<6;t++)r[t]=e[t]}else if(5===t)r[0]="Push",r[1]="Pull",r[2]="Legs",r[3]="Upper",r[4]="Full Body";else if(4===t){r[0]="Upper A",r[2]="Lower A",r[3]="Upper B",r[5]="Lower B";let e=["Upper A","Lower A","Upper B","Lower B"];r.fill(null),[0,1,3,4].forEach((t,n)=>{r[t]=e[n]})}else 3===t?(r[0]="Full Body A",r[2]="Full Body B",r[4]="Full Body C"):2===t&&(r[0]="Upper",r[3]="Lower");return n.isPowerlifter&&r[5],r}let l=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function c(e){let t,n,c;let d=function(e){let{sport:t,raceGoals:n}=e,r=n||[],a="triathlon"===t||r.some(e=>["sprint_tri","olympic_tri","half_ironman","full_ironman"].includes(e.type)),i="running"===t||r.some(e=>["5k_10k","half_marathon","full_marathon"].includes(e.type)),s="swimming"===t||r.some(e=>"swim_race"===e.type),o="cycling"===t||r.some(e=>"cycling_race"===e.type),l=r.some(e=>"ocr"===e.type),c=r.some(e=>"powerlifting"===e.type),d=Date.now(),u=r.filter(e=>e.date).map(e=>Math.max(0,Math.round((new Date(e.date).getTime()-d)/6048e5))),h=u.length>0?Math.min(...u):null,g="general";return a?g="triathlete":i?g="runner":s?g="swimmer":o?g="cyclist":l?g="ocr":t&&(g=t),{isTriathlete:a,isRunner:i,isSwimmer:s,isCyclist:o,isOCR:l,isPowerlifter:c,primarySport:g,weeksToRace:h,inTaper:null!==h&&h<=3,raceApproaching:null!==h&&h<=6}}(e),u=Math.min(e.trainingDays,5),h=function(e,t){let n=e.trainingVolume||"intermediate";return t.isTriathlete||t.isRunner?"advanced"===n?5:"intermediate"===n?4:3:t.isSwimmer||t.isCyclist?"advanced"===n?4:3:"endurance"===e.goal?4:"fat_loss"===e.goal?3:2}(e,d);d.isTriathlete?(t=function(e,t,n,r){let s=o(7,n,t),c=t.inTaper,d={0:i(a("run-easy")),1:i(a("swim-drills")),2:i(c?a("run-easy"):a("run-tempo")),3:i(c?a("bike-recovery"):a("bike-endurance")),4:i(a("swim-pull")),5:i(c?a("run-easy"):a("run-long")),6:null};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:d[t]||void 0,isRest:6===t,note:6===t?"Rest & recovery":c&&[3,5].includes(t)?"Taper week — keep intensity low":void 0}))}(0,d,u,0),n="triathlete",c=d.inTaper?"Taper week — reducing volume ahead of race":"Triathlon hybrid: swim, bike, run + strength"):d.isRunner?(t=function(e,t,n,r){let s=o(7,n,t),c=t.inTaper,d={0:i(a("run-easy")),1:i(c?a("run-easy"):a("run-400-intervals")),2:i(a("run-easy")),3:i(c?a("run-easy"):a("run-tempo")),4:i(a("run-easy")),5:i(c?a("run-easy"):a("run-long")),6:null};return r<5&&delete d[4],r<4&&delete d[2],l.map((e,n)=>({day:e,dayIndex:n,hasStrength:!!s[n],strengthLabel:s[n]||void 0,cardio:d[n]||void 0,isRest:6===n&&!d[6],note:t.raceApproaching&&5===n?"Key long run — race simulation pace":void 0}))}(0,d,u,h),n="runner",c=d.raceApproaching?"Race-specific run build + strength support":"Running hybrid: aerobic base + speed work + strength"):d.isSwimmer?(t=function(e,t,n,r){let s=o(7,n,t),c=t.inTaper,d={0:i(a("swim-drills")),1:null,2:i(c?a("swim-endurance"):a("swim-pull")),3:i(c?a("swim-drills"):a("swim-sprints")),4:i(a("swim-kick")),5:i(a("swim-endurance")),6:null};return r<4&&delete d[4],l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:d[t]||void 0,isRest:!d[t]&&!s[t]}))}(0,d,u,h),n="swimmer",c="Swimming hybrid: technique + strength + endurance"):d.isCyclist?(t=function(e,t,n,r){let s=o(7,n,t),c=t.inTaper,d={0:i(a("bike-recovery")),1:null,2:i(c?a("bike-recovery"):a("bike-threshold")),3:i(a("bike-endurance")),4:null,5:i(a("bike-endurance")),6:null};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!s[t],strengthLabel:s[t]||void 0,cardio:d[t]||void 0,isRest:!d[t]&&!s[t],note:5===t?"Long ride — aim for 60–90 min":void 0}))}(0,d,u,0),n="cyclist",c="Cycling hybrid: threshold + endurance + strength"):"endurance"===e.goal?(t=function(e,t){let n=o(7,t,{isTriathlete:!1}),r={0:i(a("run-easy")),1:null,2:i(a("run-800-repeats")),3:i(a("bike-endurance")),4:null,5:i(a("run-long")),6:i(a("bike-recovery"))};return l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!n[t],strengthLabel:n[t]||void 0,cardio:r[t]||void 0,isRest:!r[t]&&!n[t]}))}(0,u),n="endurance",c="Endurance-focused hybrid: aerobic volume + strength maintenance"):(t=function(e,t,n){let r=o(7,t,{}),c=[i(a("run-fartlek")),i(a("hiit-jump-rope-tabata")),i(a("row-steady-state")),i(a("bike-recovery")),i(a("run-easy"))],d=l.map((e,t)=>({day:e,dayIndex:t,hasStrength:!!r[t],strengthLabel:r[t]||void 0,cardio:void 0,isRest:!1})),u=0,h=[...c];for(let e=0;e<7&&u<n;e++)!d[e].hasStrength&&6!==e&&(s(d,e)?d[e].cardio=i(a("bike-recovery")):d[e].cardio=h[u%h.length],u++);return d.forEach(e=>{e.isRest=!e.hasStrength&&!e.cardio}),d}(0,u,h),n="general",c="General hybrid: strength-primary with cardio for conditioning");let g=(t=function(e){for(let t=0;t<e.length;t++){let n=e[t].cardio;if(n){if(function(e,t){let n=0;for(let r=t-1;r>=0;r--){let t=e[r].cardio;if(t&&("hard"===t.intensity||"max"===t.intensity))n++;else break}return n}(e,t)>=2&&("hard"===n.intensity||"max"===n.intensity)){let a=r.zr.find(e=>e.type===n.type&&"easy"===e.intensity)||r.zr.find(e=>"easy"===e.intensity);a&&(e[t].cardio=i(a),e[t].note=(e[t].note?e[t].note+" \xb7 ":"")+"Intensity reduced — recovery day")}if(s(e,t)&&"hard"===n.intensity){let s=r.zr.find(e=>e.type===n.type&&"easy"===e.intensity)||a("bike-recovery");e[t].cardio=i(s),e[t].note=(e[t].note?e[t].note+" \xb7 ":"")+"Easy cardio — recovery after heavy lift"}}}return e}(t)).reduce((e,t)=>e+(t.cardio?.duration||0),0),p=t.filter(e=>e.hasStrength).length;return{days:t,weeklyCardioMinutes:g,weeklyLiftDays:p,programType:n,description:c}}function d(e){let t=new Date().getDay(),n=0===t?6:t-1,r=e.days.find(e=>e.dayIndex===n);return r?.cardio||null}function u(e){let t=e.days.map(e=>{let t=[];return e.hasStrength&&t.push(`Lift (${e.strengthLabel})`),e.cardio&&t.push(`${e.cardio.title} [${e.cardio.intensity}]`),e.isRest&&0===t.length&&t.push("Rest"),`${e.day}: ${t.join(" + ")}`});return[`Program: ${e.description}`,`Weekly cardio: ${e.weeklyCardioMinutes} min | Lift days: ${e.weeklyLiftDays}`,"",...t].join("\n")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972,3112,213,1679],()=>n(97009));module.exports=r})();