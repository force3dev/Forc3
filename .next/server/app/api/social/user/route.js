"use strict";(()=>{var e={};e.id=3866,e.ids=[3866,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},16772:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>d,dynamic:()=>c});var n=t(49303),o=t(88716),a=t(60670),i=t(87070),u=t(61165),l=t(13538);let c="force-dynamic";async function d(e){let r=await (0,u.getCurrentUserId)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),s=t.get("username"),n=t.get("userId");if(!s&&!n)return i.NextResponse.json({error:"username or userId required"},{status:400});let o=await l.prisma.user.findFirst({where:s?{username:s}:{id:n},select:{id:!0,username:!0,displayName:!0,avatarUrl:!0,bio:!0,isPrivate:!0,streak:{select:{currentStreak:!0,level:!0}},_count:{select:{followers:!0,following:!0,workoutLogs:!0}}}});if(!o)return i.NextResponse.json({error:"User not found"},{status:404});let a=await l.prisma.block.findFirst({where:{OR:[{blockerId:o.id,blockedId:r},{blockerId:r,blockedId:o.id}]}}),c=!!await l.prisma.follow.findUnique({where:{followerId_followingId:{followerId:r,followingId:o.id}}}),d=!c&&!!await l.prisma.followRequest.findUnique({where:{senderId_receiverId:{senderId:r,receiverId:o.id}}}),p=[];return(!o.isPrivate||c||o.id===r)&&(p=await l.prisma.sharedWorkout.findMany({where:{userId:o.id,isPublic:!0},include:{workout:{select:{name:!0}},_count:{select:{likes:!0,comments:!0,copies:!0}}},orderBy:{createdAt:"desc"},take:10})),i.NextResponse.json({user:{...o,followers:o._count.followers,following:o._count.following,workouts:o._count.workoutLogs,level:o.streak?.level||1,streak:o.streak?.currentStreak||0},isFollowing:c,isPending:d,isBlocked:!!a,sharedWorkouts:p})}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/social/user/route",pathname:"/api/social/user",filename:"route",bundlePath:"app/api/social/user/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\social\\user\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:f}=p,g="/api/social/user/route";function x(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},95456:(e,r,t)=>{t.d(r,{AX:()=>d,Gg:()=>c,Rf:()=>p,ed:()=>u});var s=t(86890),n=t(41463),o=t(71615);let a=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),i="forc3_session";async function u(e){return await new s.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(a)}async function l(e){try{let{payload:r}=await (0,n._)(e,a);return r}catch{return null}}async function c(){let e=await (0,o.cookies)(),r=e.get(i)?.value;return r?l(r):null}function d(e){return{name:i,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function p(){return{name:i,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},13538:(e,r,t)=>{t.d(r,{prisma:()=>n});var s=t(53524);let n=globalThis.prisma||new s.PrismaClient({log:["warn","error"]})},61165:(e,r,t)=>{t.d(r,{getCurrentUserId:()=>n});var s=t(95456);async function n(){let e=await (0,s.Gg)();return e?.userId??null}t(13538)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,3112],()=>t(16772));module.exports=s})();