"use strict";(()=>{var e={};e.id=8923,e.ids=[8923,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56931:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>I});var a={};r.r(a),r.d(a,{DELETE:()=>w,POST:()=>p,dynamic:()=>c});var o=r(49303),s=r(88716),n=r(60670),i=r(87070),l=r(61165),u=r(13538),d=r(34480);let c="force-dynamic";async function p(e){let t=await (0,l.getCurrentUserId)();if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),a=r.targetUserId||r.userId;if(!a||a===t)return i.NextResponse.json({error:"Invalid target"},{status:400});let o=await u.prisma.user.findUnique({where:{id:a}});if(!o)return i.NextResponse.json({error:"User not found"},{status:404});if(await u.prisma.block.findFirst({where:{OR:[{blockerId:a,blockedId:t},{blockerId:t,blockedId:a}]}}))return i.NextResponse.json({error:"Cannot follow"},{status:403});if(o.isPrivate)return await u.prisma.followRequest.upsert({where:{senderId_receiverId:{senderId:t,receiverId:a}},update:{},create:{senderId:t,receiverId:a}}),await u.prisma.notification.create({data:{userId:a,type:"follow_request",data:{fromUserId:t}}}),i.NextResponse.json({status:"pending"});await u.prisma.follow.upsert({where:{followerId_followingId:{followerId:t,followingId:a}},update:{},create:{followerId:t,followingId:a}}),await u.prisma.notification.create({data:{userId:a,type:"new_follower",data:{fromUserId:t}}});let s=await u.prisma.follow.count({where:{followingId:a}});return await (0,d.x)(t,"new_follower",{followerId:t,targetUserId:a}),i.NextResponse.json({status:"following",followerCount:s})}async function w(e){let t=await (0,l.getCurrentUserId)();if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),a=r.targetUserId||r.userId;if(!a)return i.NextResponse.json({error:"userId required"},{status:400});await u.prisma.follow.deleteMany({where:{followerId:t,followingId:a}}),await u.prisma.followRequest.deleteMany({where:{senderId:t,receiverId:a}});let o=await u.prisma.follow.count({where:{followingId:a}});return i.NextResponse.json({success:!0,followerCount:o})}let f=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/social/follow/route",pathname:"/api/social/follow",filename:"route",bundlePath:"app/api/social/follow/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\social\\follow\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:I,serverHooks:g}=f,x="/api/social/follow/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:I})}},34480:(e,t,r)=>{r.d(t,{x:()=>o});var a=r(13538);async function o(e,t,r,o=!0){try{await a.prisma.activity.create({data:{userId:e,type:t,data:r,isPublic:o}})}catch(e){console.error("[activity-feed] Failed to post activity:",e)}}},95456:(e,t,r)=>{r.d(t,{AX:()=>c,Gg:()=>d,Rf:()=>p,ed:()=>l});var a=r(86890),o=r(41463),s=r(71615);let n=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),i="forc3_session";async function l(e){return await new a.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(n)}async function u(e){try{let{payload:t}=await (0,o._)(e,n);return t}catch{return null}}async function d(){let e=await (0,s.cookies)(),t=e.get(i)?.value;return t?u(t):null}function c(e){return{name:i,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function p(){return{name:i,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},13538:(e,t,r)=>{r.d(t,{prisma:()=>o});var a=r(53524);let o=globalThis.prisma||new a.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{getCurrentUserId:()=>o});var a=r(95456);async function o(){let e=await (0,a.Gg)();return e?.userId??null}r(13538)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,3112],()=>r(56931));module.exports=a})();