"use strict";(()=>{var e={};e.id=8568,e.ids=[8568],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86690:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var t={};s.r(t),s.d(t,{GET:()=>g,dynamic:()=>p});var o=s(49303),i=s(88716),n=s(60670),a=s(87070),d=s(61165),c=s(13538);async function u(e,r,s,t,o="imperial"){let i=new Map,n=s>1&&s%t==0;for(let s of r){let r=await c.prisma.exerciseLog.findFirst({where:{exerciseId:s.exerciseId,workoutLog:{userId:e}},orderBy:{createdAt:"desc"},include:{sets:{orderBy:{setNumber:"asc"},where:{isWarmup:!1}}}}),t=function(e){let r=["quads","hamstrings","glutes","calves","legs"];return e.some(e=>r.includes(e.toLowerCase()))}(s.muscleGroups),a="metric"===o?t?2.5:1.25:t?10:5;if(!r||0===r.sets.length){i.set(s.exerciseId,{exerciseId:s.exerciseId,suggestedWeight:t?135:45,progressionType:"first_time",badge:null,reason:"First time — start light and focus on form"});continue}let d=r.sets,u=d[0]?.weight||45,l=d.length,p=d.every(e=>e.reps>=s.repsMax),g=d.every(e=>e.reps>=s.repsMin);if(n){let e=2.5*Math.round(.8*u/2.5);i.set(s.exerciseId,{exerciseId:s.exerciseId,suggestedWeight:e,progressionType:"deload",badge:"\uD83D\uDD04 Deload",reason:"Deload week — 80% of last weight, focus on recovery"});continue}if(p&&l>=s.sets){let e=u+a;i.set(s.exerciseId,{exerciseId:s.exerciseId,suggestedWeight:e,progressionType:"increase",badge:`⬆️ +${a} ${"metric"===o?"kg":"lbs"}`,reason:`Hit top of rep range last session — time to add weight`})}else g?i.set(s.exerciseId,{exerciseId:s.exerciseId,suggestedWeight:u,progressionType:"hold",badge:null,reason:"Making progress — keep same weight and aim for top of rep range"}):i.set(s.exerciseId,{exerciseId:s.exerciseId,suggestedWeight:u,progressionType:"hold",badge:"\uD83C\uDFAF Hold",reason:"Didn't hit minimum reps last session — keep this weight"})}return i}var l=s(40740);let p="force-dynamic";async function g(){try{let e=await (0,d.getCurrentUserId)();if(!e)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await c.prisma.trainingPlan.findUnique({where:{userId:e},include:{workouts:{orderBy:{order:"asc"},include:{exercises:{orderBy:{order:"asc"},include:{exercise:!0}}}}}});if(!r)return a.NextResponse.json({needsOnboarding:!0,error:"No plan found"},{status:404});let s=new Date;s.getDay(),s.getTime(),r.startedAt.getTime();let t=new Date(s);t.setDate(s.getDate()-(s.getDay()+6)%7),t.setHours(0,0,0,0);let o=new Date(s);o.setHours(0,0,0,0);let i=new Date(s);i.setHours(23,59,59,999);let n=await c.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:o,lte:i}}}),p=(await c.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:t},completedAt:{not:null}},orderBy:{startedAt:"asc"}})).length,g=p%r.workouts.length,m=r.workouts[g];if((p>=r.daysPerWeek||n.some(e=>null!==e.completedAt))&&!n.some(e=>null===e.completedAt))return a.NextResponse.json({isRestDay:!0,currentWeek:r.currentWeek,workoutsThisWeek:p,daysPerWeek:r.daysPerWeek,message:p>=r.daysPerWeek?"Weekly goal hit! Rest and recover.":"Rest day. Your muscles grow when you rest."});let x=await c.prisma.profile.findUnique({where:{userId:e}}),y=x?.unitSystem||"imperial",w=m.exercises.map(e=>({exerciseId:e.exerciseId,name:e.exercise.name,sets:e.sets,repsMin:e.repsMin,repsMax:e.repsMax,muscleGroups:JSON.parse(e.exercise.muscleGroups||"[]")})),h=await u(e,w,r.currentWeek,r.deloadFrequency,y),f=await Promise.all(m.exercises.map(async r=>{let s=await c.prisma.exerciseLog.findFirst({where:{exerciseId:r.exerciseId,workoutLog:{userId:e}},orderBy:{createdAt:"desc"},include:{sets:{orderBy:{setNumber:"asc"}}}}),t=s?.sets[0]?.weight||null,o=s?.sets?.map(e=>({reps:e.reps,weight:e.weight}))||[],i=h.get(r.exerciseId);return{id:r.id,exerciseId:r.exerciseId,name:r.exercise.name,sets:r.sets,repsMin:r.repsMin,repsMax:r.repsMax,rpe:r.rpe,restSeconds:r.restSeconds,muscleGroups:JSON.parse(r.exercise.muscleGroups||"[]"),gifUrl:r.exercise.gifUrl||null,secondaryMuscles:r.exercise.secondaryMuscles||"[]",formTips:r.exercise.formTips||"[]",commonMistakes:r.exercise.commonMistakes||"[]",instructions:r.exercise.instructions||null,category:r.exercise.category||"strength",lastWeight:t,lastSets:o,suggestedWeight:i?.suggestedWeight||t||null,progressionBadge:i?.badge||null,progressionReason:i?.reason||null}})),k=[];if(process.env.CLAUDE_API_KEY)try{k=await (0,l.O1)(e,m.name,f.map(e=>e.name))}catch{}return a.NextResponse.json({isRestDay:!1,currentWeek:r.currentWeek,workoutsThisWeek:p,daysPerWeek:r.daysPerWeek,workout:{id:m.id,name:m.name,order:m.order,exercises:f,coachingNotes:k},inProgressLog:n.find(e=>null===e.completedAt)?.id||null})}catch(e){return console.error("Today workout error:",e),a.NextResponse.json({error:"Failed to load workout"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/workouts/today/route",pathname:"/api/workouts/today",filename:"route",bundlePath:"app/api/workouts/today/route"},resolvedPagePath:"/home/runner/work/Forc3/Forc3/src/app/api/workouts/today/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:w}=m,h="/api/workouts/today/route";function f(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[8948,5972,3112,213,1679,740],()=>s(86690));module.exports=t})();