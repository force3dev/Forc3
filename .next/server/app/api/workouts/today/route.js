"use strict";(()=>{var e={};e.id=8568,e.ids=[8568],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22991:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var t={};r.r(t),r.d(t,{GET:()=>g,dynamic:()=>p});var i=r(49303),o=r(88716),a=r(60670),n=r(87070),d=r(61165),c=r(13538);async function u(e,s,r,t,i="imperial"){let o=new Map,a=r>1&&r%t==0;for(let r of s){let s=await c.prisma.exerciseLog.findFirst({where:{exerciseId:r.exerciseId,workoutLog:{userId:e}},orderBy:{createdAt:"desc"},include:{sets:{orderBy:{setNumber:"asc"},where:{isWarmup:!1}}}}),t=function(e){let s=["quads","hamstrings","glutes","calves","legs"];return e.some(e=>s.includes(e.toLowerCase()))}(r.muscleGroups),n="metric"===i?t?2.5:1.25:t?10:5;if(!s||0===s.sets.length){o.set(r.exerciseId,{exerciseId:r.exerciseId,suggestedWeight:t?135:45,progressionType:"first_time",badge:null,reason:"First time — start light and focus on form"});continue}let d=s.sets,u=d[0]?.weight||45,l=d.length,p=d.every(e=>e.reps>=r.repsMax),g=d.every(e=>e.reps>=r.repsMin);if(a){let e=2.5*Math.round(.8*u/2.5);o.set(r.exerciseId,{exerciseId:r.exerciseId,suggestedWeight:e,progressionType:"deload",badge:"\uD83D\uDD04 Deload",reason:"Deload week — 80% of last weight, focus on recovery"});continue}if(p&&l>=r.sets){let e=u+n;o.set(r.exerciseId,{exerciseId:r.exerciseId,suggestedWeight:e,progressionType:"increase",badge:`⬆️ +${n} ${"metric"===i?"kg":"lbs"}`,reason:`Hit top of rep range last session — time to add weight`})}else g?o.set(r.exerciseId,{exerciseId:r.exerciseId,suggestedWeight:u,progressionType:"hold",badge:null,reason:"Making progress — keep same weight and aim for top of rep range"}):o.set(r.exerciseId,{exerciseId:r.exerciseId,suggestedWeight:u,progressionType:"hold",badge:"\uD83C\uDFAF Hold",reason:"Didn't hit minimum reps last session — keep this weight"})}return o}var l=r(40740);let p="force-dynamic";async function g(){try{let e=await (0,d.getCurrentUserId)();if(!e)return n.NextResponse.json({error:"Unauthorized"},{status:401});let s=await c.prisma.trainingPlan.findUnique({where:{userId:e},include:{workouts:{orderBy:{order:"asc"},include:{exercises:{orderBy:{order:"asc"},include:{exercise:!0}}}}}});if(!s)return n.NextResponse.json({needsOnboarding:!0,error:"No plan found"},{status:404});let r=new Date;r.getDay(),r.getTime(),s.startedAt.getTime();let t=new Date(r);t.setDate(r.getDate()-(r.getDay()+6)%7),t.setHours(0,0,0,0);let i=new Date(r);i.setHours(0,0,0,0);let o=new Date(r);o.setHours(23,59,59,999);let a=await c.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:i,lte:o}}}),p=(await c.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:t},completedAt:{not:null}},orderBy:{startedAt:"asc"}})).length,g=p%s.workouts.length,m=s.workouts[g];if((p>=s.daysPerWeek||a.some(e=>null!==e.completedAt))&&!a.some(e=>null===e.completedAt))return n.NextResponse.json({isRestDay:!0,currentWeek:s.currentWeek,workoutsThisWeek:p,daysPerWeek:s.daysPerWeek,message:p>=s.daysPerWeek?"Weekly goal hit! Rest and recover.":"Rest day. Your muscles grow when you rest."});let x=await c.prisma.profile.findUnique({where:{userId:e}}),y=x?.unitSystem||"imperial",w=m.exercises.map(e=>({exerciseId:e.exerciseId,name:e.exercise.name,sets:e.sets,repsMin:e.repsMin,repsMax:e.repsMax,muscleGroups:JSON.parse(e.exercise.muscleGroups||"[]")})),h=await u(e,w,s.currentWeek,s.deloadFrequency,y),f=await Promise.all(m.exercises.map(async s=>{let r=await c.prisma.exerciseLog.findFirst({where:{exerciseId:s.exerciseId,workoutLog:{userId:e}},orderBy:{createdAt:"desc"},include:{sets:{orderBy:{setNumber:"asc"}}}}),t=r?.sets[0]?.weight||null,i=r?.sets?.map(e=>({reps:e.reps,weight:e.weight}))||[],o=h.get(s.exerciseId);return{id:s.id,exerciseId:s.exerciseId,name:s.exercise.name,sets:s.sets,repsMin:s.repsMin,repsMax:s.repsMax,rpe:s.rpe,restSeconds:s.restSeconds,muscleGroups:JSON.parse(s.exercise.muscleGroups||"[]"),gifUrl:s.exercise.gifUrl||null,secondaryMuscles:s.exercise.secondaryMuscles||"[]",formTips:s.exercise.formTips||"[]",commonMistakes:s.exercise.commonMistakes||"[]",coachingCues:s.exercise.coachingCues||"[]",alternatives:s.exercise.alternatives||"[]",instructions:s.exercise.instructions||null,category:s.exercise.category||"strength",lastWeight:t,lastSets:i,suggestedWeight:o?.suggestedWeight||t||null,progressionBadge:o?.badge||null,progressionReason:o?.reason||null}})),k=[];if(process.env.CLAUDE_API_KEY)try{k=await (0,l.O1)(e,m.name,f.map(e=>e.name))}catch{}return n.NextResponse.json({isRestDay:!1,currentWeek:s.currentWeek,workoutsThisWeek:p,daysPerWeek:s.daysPerWeek,workout:{id:m.id,name:m.name,order:m.order,exercises:f,coachingNotes:k},inProgressLog:a.find(e=>null===e.completedAt)?.id||null})}catch(e){return console.error("Today workout error:",e),n.NextResponse.json({error:"Failed to load workout"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/workouts/today/route",pathname:"/api/workouts/today",filename:"route",bundlePath:"app/api/workouts/today/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\workouts\\today\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:y,serverHooks:w}=m,h="/api/workouts/today/route";function f(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[8948,5972,3112,213,1679,740],()=>r(22991));module.exports=t})();