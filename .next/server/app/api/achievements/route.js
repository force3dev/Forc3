"use strict";(()=>{var e={};e.id=8376,e.ids=[8376,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54758:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{GET:()=>l,dynamic:()=>p});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),c=r(61165),u=r(13538),d=r(41295);let p="force-dynamic";async function l(){let e=await (0,c.getCurrentUserId)();if(!e)return s.NextResponse.json({error:"Unauthorized"},{status:401});await (0,d.Mu)();let[t,r]=await Promise.all([u.prisma.achievement.findMany({orderBy:[{category:"asc"},{xpReward:"asc"}]}),u.prisma.userAchievement.findMany({where:{userId:e},include:{achievement:!0}})]),n=new Set(r.map(e=>e.achievementId)),a=t.map(e=>({id:e.id,code:e.code,name:e.name,description:e.description,icon:e.icon,category:e.category,xpReward:e.xpReward,unlocked:n.has(e.id),unlockedAt:r.find(t=>t.achievementId===e.id)?.unlockedAt||null})),i=r.reduce((e,t)=>e+t.achievement.xpReward,0);return s.NextResponse.json({achievements:a,totalXP:i,unlockedCount:r.length})}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/achievements/route",pathname:"/api/achievements",filename:"route",bundlePath:"app/api/achievements/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\achievements\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:w}=m,f="/api/achievements/route";function h(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},95456:(e,t,r)=>{r.d(t,{AX:()=>p,Gg:()=>d,Rf:()=>l,ed:()=>c});var n=r(86890),a=r(41463),i=r(71615);let o=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),s="forc3_session";async function c(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(o)}async function u(e){try{let{payload:t}=await (0,a._)(e,o);return t}catch{return null}}async function d(){let e=await (0,i.cookies)(),t=e.get(s)?.value;return t?u(t):null}function p(e){return{name:s,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function l(){return{name:s,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},41295:(e,t,r)=>{r.d(t,{Mu:()=>i,am:()=>o});var n=r(13538);let a=[{code:"first_workout",name:"First Sweat",description:"Complete your first workout",icon:"\uD83C\uDFCB️",category:"milestone",requirement:JSON.stringify({type:"workouts_completed",value:1}),xpReward:50},{code:"ten_workouts",name:"Getting Consistent",description:"Complete 10 workouts",icon:"\uD83D\uDCAA",category:"milestone",requirement:JSON.stringify({type:"workouts_completed",value:10}),xpReward:100},{code:"fifty_workouts",name:"Dedicated Athlete",description:"Complete 50 workouts",icon:"\uD83D\uDD11",category:"milestone",requirement:JSON.stringify({type:"workouts_completed",value:50}),xpReward:250},{code:"first_pr",name:"Personal Best",description:"Set your first personal record",icon:"\uD83C\uDFC6",category:"strength",requirement:JSON.stringify({type:"prs_total",value:1}),xpReward:75},{code:"ten_prs",name:"PR Machine",description:"Set 10 personal records",icon:"\uD83E\uDD47",category:"strength",requirement:JSON.stringify({type:"prs_total",value:10}),xpReward:200},{code:"streak_7",name:"Week Warrior",description:"Maintain a 7-day workout streak",icon:"\uD83D\uDD25",category:"consistency",requirement:JSON.stringify({type:"streak",value:7}),xpReward:150},{code:"streak_30",name:"Iron Discipline",description:"Maintain a 30-day workout streak",icon:"⚡",category:"consistency",requirement:JSON.stringify({type:"streak",value:30}),xpReward:500},{code:"volume_100k",name:"Century Club",description:"Lift 100,000 lbs total volume",icon:"\uD83E\uDDBE",category:"strength",requirement:JSON.stringify({type:"total_volume",value:1e5}),xpReward:300},{code:"sets_100",name:"The Grinder",description:"Log 100 total sets",icon:"⚙️",category:"milestone",requirement:JSON.stringify({type:"total_sets",value:100}),xpReward:100},{code:"nutrition_logged",name:"Fueled Right",description:"Log your nutrition for the first time",icon:"\uD83E\uDD57",category:"nutrition",requirement:JSON.stringify({type:"nutrition_logs",value:1}),xpReward:50},{code:"nutrition_week",name:"Macro Master",description:"Log nutrition for 7 consecutive days",icon:"\uD83D\uDCCA",category:"nutrition",requirement:JSON.stringify({type:"nutrition_streak",value:7}),xpReward:200},{code:"perfect_week",name:"Perfect Week",description:"Hit 100% of your weekly training sessions",icon:"⭐",category:"consistency",requirement:JSON.stringify({type:"weekly_compliance",value:1}),xpReward:150}];async function i(){for(let e of a)await n.prisma.achievement.upsert({where:{code:e.code},update:{name:e.name,description:e.description,icon:e.icon,xpReward:e.xpReward},create:e})}async function o(e){let[t,r,a,i]=await Promise.all([n.prisma.workoutLog.findMany({where:{userId:e,completedAt:{not:null}},include:{exerciseLogs:{include:{sets:!0}}}}),n.prisma.personalRecord.findMany({where:{userId:e}}),n.prisma.streak.findUnique({where:{userId:e}}),n.prisma.profile.findUnique({where:{userId:e}})]),o=t.length,s=t.reduce((e,t)=>e+t.exerciseLogs.reduce((e,t)=>e+t.sets.length,0),0),c=t.reduce((e,t)=>e+t.exerciseLogs.reduce((e,t)=>e+t.sets.reduce((e,t)=>e+t.weight*t.reps,0),0),0),u=r.length,d=a?.currentStreak||0,p=await n.prisma.nutritionLog.count({where:{userId:e}}),l=new Set((await n.prisma.userAchievement.findMany({where:{userId:e},select:{achievementId:!0}})).map(e=>e.achievementId)),m=await n.prisma.achievement.findMany(),y=new Date,g=new Date(y);g.setDate(y.getDate()-(y.getDay()+6)%7),g.setHours(0,0,0,0);let w=await n.prisma.trainingPlan.findUnique({where:{userId:e}}),f=w?.daysPerWeek||4,h=t.filter(e=>new Date(e.startedAt)>=g).length,v=h>=f?1:0,k=[];for(let t of m){if(l.has(t.id))continue;let r=JSON.parse(t.requirement),a=!1;switch(r.type){case"workouts_completed":a=o>=r.value;break;case"prs_total":a=u>=r.value;break;case"streak":a=d>=r.value;break;case"total_volume":a=c>=r.value;break;case"total_sets":a=s>=r.value;break;case"nutrition_logs":a=p>=r.value;break;case"nutrition_streak":a=p>=3*r.value;break;case"weekly_compliance":a=v>=r.value&&h>0}a&&(await n.prisma.userAchievement.create({data:{userId:e,achievementId:t.id}}),k.push({code:t.code,name:t.name,icon:t.icon,xpReward:t.xpReward}))}return k}},13538:(e,t,r)=>{r.d(t,{prisma:()=>a});var n=r(53524);let a=globalThis.prisma||new n.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{getCurrentUserId:()=>a});var n=r(95456);async function a(){let e=await (0,n.Gg)();return e?.userId??null}r(13538)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,3112],()=>r(54758));module.exports=n})();