"use strict";(()=>{var e={};e.id=3448,e.ids=[3448,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48029:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>v});var r={};a.r(r),a.d(r,{GET:()=>u,POST:()=>c});var s=a(49303),i=a(88716),n=a(60670),o=a(87070),p=a(13538);async function u(e){let t=e.nextUrl.searchParams.get("hub.challenge");return e.nextUrl.searchParams.get("hub.verify_token")===process.env.STRAVA_WEBHOOK_VERIFY_TOKEN?o.NextResponse.json({"hub.challenge":t}):o.NextResponse.json({error:"Forbidden"},{status:403})}async function c(e){let{object_type:t,object_id:a,owner_id:r,aspect_type:s}=await e.json();if("activity"!==t||"create"!==s)return o.NextResponse.json({ok:!0});let i=await p.prisma.user.findFirst({where:{stravaAthleteId:String(r)}});if(!i?.stravaAccessToken)return o.NextResponse.json({ok:!0});let n=await fetch(`https://www.strava.com/api/v3/activities/${a}`,{headers:{Authorization:`Bearer ${i.stravaAccessToken}`}}),u=await n.json();return u.id&&await p.prisma.stravaActivity.upsert({where:{stravaId:String(u.id)},create:{userId:i.id,stravaId:String(u.id),name:u.name,type:u.type,date:new Date(u.start_date),distance:u.distance,duration:u.moving_time,elevation:u.total_elevation_gain,avgHeartRate:u.average_heartrate,maxHeartRate:u.max_heartrate,avgPace:u.distance>0?u.moving_time/(u.distance/1e3):null,calories:u.calories},update:{}}),o.NextResponse.json({ok:!0})}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/strava/webhook/route",pathname:"/api/strava/webhook",filename:"route",bundlePath:"app/api/strava/webhook/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\strava\\webhook\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:v,serverHooks:h}=d,m="/api/strava/webhook/route";function g(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:v})}},13538:(e,t,a)=>{a.d(t,{prisma:()=>s});var r=a(53524);let s=globalThis.prisma||new r.PrismaClient({log:["warn","error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>a(48029));module.exports=r})();