"use strict";(()=>{var e={};e.id=6073,e.ids=[6073,1165,3538],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51013:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>x,requestAsyncStorage:()=>w,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>h,dynamic:()=>g});var n=r(49303),a=r(88716),i=r(60670),o=r(87070),l=r(61165),u=r(13538);function c(e=0){let t=new Date,r=new Date(t);r.setDate(t.getDate()-(t.getDay()+6)%7-7*e),r.setHours(0,0,0,0);let s=new Date(r);return s.setDate(r.getDate()+6),s.setHours(23,59,59,999),{start:r,end:s}}async function p(e){let{start:t,end:r}=c(0),{start:s,end:n}=c(1),a=await u.prisma.trainingPlan.findUnique({where:{userId:e}}),i=a?.daysPerWeek||4,o=await u.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:t,lte:r},completedAt:{not:null}},include:{exerciseLogs:{include:{sets:!0}}}}),l=await u.prisma.workoutLog.findMany({where:{userId:e,startedAt:{gte:s,lte:n},completedAt:{not:null}},include:{exerciseLogs:{include:{sets:!0}}}}),p=o.length;function d(e){return e.reduce((e,t)=>e+t.exerciseLogs.reduce((e,t)=>e+t.sets.reduce((e,t)=>e+t.weight*t.reps,0),0),0)}let g=d(o),h=d(l),m=o.filter(e=>null!==e.overallRpe),w=m.length>0?m.reduce((e,t)=>e+(t.overallRpe||0),0)/m.length:null,y=o.reduce((e,t)=>e+t.exerciseLogs.reduce((e,t)=>e+t.sets.filter(e=>e.isPR).length,0),0),f=Math.min(1,p/i),k="first_week",x="first_week";if(l.length>0){let e=(g-h)/Math.max(h,1)*100;k=e>5?"increasing":e<-5?"decreasing":"stable",x=y>0?"increasing":l.length>0?"stable":"first_week"}let v=7;null!==w&&(w>=9?v-=2:w>=8?v-=1:w<=6&&(v+=1)),f>=1&&(v+=1),f<.5&&(v-=2),v=Math.min(10,Math.max(0,v));let R=[];0===p?R.push("No workouts logged this week yet — the week isn't over!"):f>=1?R.push(`Perfect week! Hit all ${i} planned sessions.`):R.push(`Completed ${p}/${i} sessions (${Math.round(100*f)}% compliance).`),"increasing"===k&&R.push("Volume is up from last week — great progressive overload."),"decreasing"===k&&R.push("Volume dropped this week — consider adding a set or two per exercise."),y>0&&R.push(`Hit ${y} personal record${y>1?"s":""} this week!`),null!==w&&w>=8.5&&R.push("High average RPE — prioritize sleep and nutrition for recovery.");let P=[];f<.75&&P.push("Aim for consistency over intensity — hit your session targets first."),"stable"===k&&f>=1&&P.push("You're ready to add volume — try an extra set on your main lifts."),null!==w&&w>=9&&f>=1&&P.push("Consider a light deload session next week to manage fatigue."),0===y&&p>=2&&P.push("Push harder on your first sets — that's where PRs happen.");let A="Maintain consistency and progressive overload";f<1?A="Prioritize hitting all sessions this week":"increasing"===k&&null!==w&&w>=8.5?A="Deload to consolidate gains":y>0&&(A="Build on this week's PRs — keep the momentum");let S=await u.prisma.weeklyReport.findFirst({where:{userId:e,weekStart:{gte:t,lte:r}}});return S?await u.prisma.weeklyReport.update({where:{id:S.id},data:{workoutsCompleted:p,totalVolume:g,avgRpe:w,prsHit:y,insights:JSON.stringify(R),recommendations:JSON.stringify(P),volumeTrend:k,strengthTrend:x,recoveryScore:v}}):await u.prisma.weeklyReport.create({data:{userId:e,weekStart:t,weekEnd:r,workoutsCompleted:p,totalVolume:g,avgRpe:w,prsHit:y,streakDays:0,insights:JSON.stringify(R),recommendations:JSON.stringify(P),volumeTrend:k,strengthTrend:x,recoveryScore:v}}),{weekStart:t,weekEnd:r,workoutsCompleted:p,targetWorkouts:i,totalVolume:g,avgRpe:w,prsHit:y,complianceRate:f,volumeTrend:k,strengthTrend:x,recoveryScore:v,insights:R,recommendations:P,nextWeekFocus:A}}var d=r(80213);let g="force-dynamic";async function h(e){let t=await (0,l.getCurrentUserId)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),s="true"===r.get("recap");try{let e=await p(t);if(!s||!process.env.CLAUDE_API_KEY)return o.NextResponse.json(e);let r=await u.prisma.profile.findUnique({where:{userId:t}}),n=r?.name?.split(" ")[0]||"Athlete",a=await u.prisma.streak.findUnique({where:{userId:t}}),i=new d.ZP({apiKey:process.env.CLAUDE_API_KEY}),l=`Generate a weekly training recap for ${n}.

This week's data:
- Workouts completed: ${e.workoutsCompleted} of ${e.targetWorkouts} planned
- Strength volume: ${Math.round(e.totalVolume)} lbs total volume lifted
- PRs this week: ${e.prsHit}
- Compliance rate: ${Math.round(100*e.complianceRate)}%
- Current streak: ${a?.currentStreak||0} days
- Volume trend: ${e.volumeTrend}
- Recovery score: ${e.recoveryScore}/10

Write a 3-4 sentence recap in Coach Alex's voice.
Highlight wins. Note any patterns. Set the tone for next week.
Be real and specific. Reference actual numbers.
End with one key focus for next week.`,c=await i.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:250,messages:[{role:"user",content:l}]}),g="text"===c.content[0].type?c.content[0].text:"";return o.NextResponse.json({...e,recapText:g,streakDays:a?.currentStreak||0})}catch(e){return console.error("Weekly analysis error:",e),o.NextResponse.json({error:"Failed to analyze week"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/progress/weekly/route",pathname:"/api/progress/weekly",filename:"route",bundlePath:"app/api/progress/weekly/route"},resolvedPagePath:"C:\\Users\\Geric\\Desktop\\forc3\\src\\app\\api\\progress\\weekly\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:f}=m,k="/api/progress/weekly/route";function x(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},95456:(e,t,r)=>{r.d(t,{AX:()=>p,Gg:()=>c,Rf:()=>d,ed:()=>l});var s=r(86890),n=r(41463),a=r(71615);let i=new TextEncoder().encode(process.env.JWT_SECRET||process.env.NEXTAUTH_SECRET||"forc3-secret-key-change-in-production"),o="forc3_session";async function l(e){return await new s.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("30d").sign(i)}async function u(e){try{let{payload:t}=await (0,n._)(e,i);return t}catch{return null}}async function c(){let e=await (0,a.cookies)(),t=e.get(o)?.value;return t?u(t):null}function p(e){return{name:o,value:e,httpOnly:!0,secure:!0,sameSite:"lax",maxAge:2592e3,path:"/"}}function d(){return{name:o,value:"",httpOnly:!0,secure:!0,sameSite:"lax",maxAge:0,path:"/"}}},13538:(e,t,r)=>{r.d(t,{prisma:()=>n});var s=r(53524);let n=globalThis.prisma||new s.PrismaClient({log:["warn","error"]})},61165:(e,t,r)=>{r.d(t,{getCurrentUserId:()=>n});var s=r(95456);async function n(){let e=await (0,s.Gg)();return e?.userId??null}r(13538)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,3112,213],()=>r(51013));module.exports=s})();