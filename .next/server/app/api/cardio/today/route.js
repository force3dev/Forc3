"use strict";(()=>{var e={};e.id=2275,e.ids=[2275],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},65192:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>y,dynamic:()=>p});var i=r(49303),a=r(88716),s=r(60670),o=r(87070),u=r(61165),l=r(13538),d=r(62643);let p="force-dynamic";async function c(){let e=await (0,u.getCurrentUserId)();if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=new Date;t.setHours(0,0,0,0);let r=new Date(t);r.setDate(r.getDate()+1);let n=await l.prisma.cardioActivity.findFirst({where:{userId:e,date:{gte:t,lt:r}},orderBy:{createdAt:"desc"}});if(n)return o.NextResponse.json({activity:n,isPlanned:!0});let i=await l.prisma.profile.findUnique({where:{userId:e}}),a=new Date;a.setDate(a.getDate()-(a.getDay()+6)%7),a.setHours(0,0,0,0);let s=await l.prisma.workoutLog.count({where:{userId:e,startedAt:{gte:a},completedAt:{not:null}}}),p=new Date().getDay(),c=function(e,t,r,n,i){let a=Array.isArray(r)&&r.length>0,s=a&&Array.isArray(r)&&r.some(e=>["sprint_tri","olympic_tri","half_ironman","full_ironman"].includes(e.type)),o="running"===t||a&&Array.isArray(r)&&r.some(e=>["5k_10k","half_marathon","full_marathon"].includes(e.type)),u="swimming"===t||a&&Array.isArray(r)&&r.some(e=>"swim_race"===e.type);if(6===n)return s||o?d.zr.find(e=>"run-long"===e.id)||null:u?d.zr.find(e=>"swim-endurance"===e.id)||null:d.zr.find(e=>"bike-endurance"===e.id)||null;if(0===n)return d.zr.find(e=>"bike-recovery"===e.id)||null;if(s){let e={1:"run-easy",2:"swim-drills",3:"run-tempo",4:"bike-endurance",5:"swim-pull"}[n];return e&&d.zr.find(t=>t.id===e)||null}if(o){let e={1:"run-easy",2:"run-easy",3:"run-400-intervals",4:"run-easy",5:"run-tempo"}[n];return e&&d.zr.find(t=>t.id===e)||null}if("endurance"===e){let e={1:"run-easy",2:"bike-endurance",3:"run-800-repeats",4:"row-steady-state",5:"run-tempo"}[n];return e&&d.zr.find(t=>t.id===e)||null}if(i>=3)return d.zr.find(e=>"bike-recovery"===e.id)||null;let l=["run-fartlek","hiit-jump-rope-tabata","row-steady-state"];return d.zr.find(e=>e.id===l[n%l.length])||null}(i?.goal||null,i?.sport||null,i?.raceGoals||null,p,s);return c?o.NextResponse.json({activity:null,suggestion:{templateId:c.id,type:c.type,title:c.title,description:c.description,duration:c.duration,intensity:c.intensity,intervals:c.intervals||null}}):o.NextResponse.json({activity:null})}async function y(e){let t=await (0,u.getCurrentUserId)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{action:r,templateId:n,activityId:i,duration:a}=await e.json();if("start"===r){let e=d.zr.find(e=>e.id===n);if(!e)return o.NextResponse.json({error:"Template not found"},{status:404});let r=new Date,i=await l.prisma.cardioActivity.create({data:{userId:t,type:e.type,title:e.title,description:e.description,intensity:e.intensity,duration:e.duration,intervals:e.intervals?JSON.parse(JSON.stringify(e.intervals)):null,date:r,completed:!1}});return o.NextResponse.json({activity:i})}if("complete"===r){let e=await l.prisma.cardioActivity.update({where:{id:i},data:{completed:!0,completedAt:new Date,duration:a??void 0}});return await l.prisma.activity.create({data:{userId:t,type:"cardio_completed",data:{cardioType:e.type,title:e.title,duration:e.duration,intensity:e.intensity},isPublic:!0}}),o.NextResponse.json({success:!0})}return o.NextResponse.json({error:"Invalid action"},{status:400})}let m=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/cardio/today/route",pathname:"/api/cardio/today",filename:"route",bundlePath:"app/api/cardio/today/route"},resolvedPagePath:"/home/runner/work/Forc3/Forc3/src/app/api/cardio/today/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:g}=m,x="/api/cardio/today/route";function v(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,3112,1679],()=>r(65192));module.exports=n})();