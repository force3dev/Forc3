"use strict";exports.id=213,exports.ids=[213],exports.modules={80213:(e,t,s)=>{var r,n,i,a,o,l,h,u,c,d,p,f,m,g,y,b,w,_,v,k,x,S,R,M,P,$,T,A,O,j,E,I,q,W,N,L,U,C,D,F,X,B,H,J,K,V,z,Q,G,Y,Z,ee,et,es,er,en,ei,ea,eo,el,eh,eu,ec,ed,ep,ef,em,eg;let ey,eb,ew;function e_(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function ev(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}s.d(t,{ZP:()=>sw});let ek=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return ek=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function ex(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eS=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eR extends Error{}class eM extends eR{constructor(e,t,s,r){super(`${eM.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new eA(e,t,s,r):401===e?new eO(e,t,s,r):403===e?new ej(e,t,s,r):404===e?new eE(e,t,s,r):409===e?new eI(e,t,s,r):422===e?new eq(e,t,s,r):429===e?new eW(e,t,s,r):e>=500?new eN(e,t,s,r):new eM(e,t,s,r):new e$({message:s,cause:eS(t)})}}class eP extends eM{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class e$ extends eM{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eT extends e${constructor({message:e}={}){super({message:e??"Request timed out."})}}class eA extends eM{}class eO extends eM{}class ej extends eM{}class eE extends eM{}class eI extends eM{}class eq extends eM{}class eW extends eM{}class eN extends eM{}let eL=/^[a-z][a-z0-9+.-]*:/i,eU=e=>eL.test(e),eC=e=>(eC=Array.isArray)(e),eD=eC;function eF(e){return"object"!=typeof e?{}:e??{}}let eX=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eR(`${e} must be an integer`);if(t<0)throw new eR(`${e} must be a positive integer`);return t},eB=e=>{try{return JSON.parse(e)}catch(e){return}},eH=e=>new Promise(t=>setTimeout(t,e)),eJ="0.78.0",eK=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,eV=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eJ,"X-Stainless-OS":eQ(Deno.build.os),"X-Stainless-Arch":ez(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eJ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eJ,"X-Stainless-OS":eQ(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ez(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eJ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eJ,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},ez=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eQ=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",eG=()=>ey??(ey=eV());function eY(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function eZ(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return eY({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function e0(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function e1(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let e2=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function e4(e){let t;return(eb??(eb=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function e5(e){let t;return(ew??(ew=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class e6{constructor(){r.set(this,void 0),n.set(this,void 0),e_(this,r,new Uint8Array,"f"),e_(this,n,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?e4(e):e;e_(this,r,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([ev(this,r,"f"),s]),"f");let i=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(ev(this,r,"f"),ev(this,n,"f")));){if(t.carriage&&null==ev(this,n,"f")){e_(this,n,t.index,"f");continue}if(null!=ev(this,n,"f")&&(t.index!==ev(this,n,"f")+1||t.carriage)){i.push(e5(ev(this,r,"f").subarray(0,ev(this,n,"f")-1))),e_(this,r,ev(this,r,"f").subarray(ev(this,n,"f")),"f"),e_(this,n,null,"f");continue}let e=null!==ev(this,n,"f")?t.preceding-1:t.preceding,s=e5(ev(this,r,"f").subarray(0,e));i.push(s),e_(this,r,ev(this,r,"f").subarray(t.index),"f"),e_(this,n,null,"f")}return i}flush(){return ev(this,r,"f").length?this.decode("\n"):[]}}r=new WeakMap,n=new WeakMap,e6.NEWLINE_CHARS=new Set(["\n","\r"]),e6.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let e3={off:0,error:200,warn:300,info:400,debug:500},e9=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(e3,e))return e;ts(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(e3))}`)}};function e8(){}function e7(e,t,s){return!t||e3[e]>e3[s]?e8:t[e].bind(t)}let te={error:e8,warn:e8,info:e8,debug:e8},tt=new WeakMap;function ts(e){let t=e.logger,s=e.logLevel??"off";if(!t)return te;let r=tt.get(t);if(r&&r[0]===s)return r[1];let n={error:e7("error",t,s),warn:e7("warn",t,s),info:e7("info",t,s),debug:e7("debug",t,s)};return tt.set(t,[s,n]),n}let tr=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tn{constructor(e,t,s){this.iterator=e,i.set(this,void 0),this.controller=t,e_(this,i,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?ts(s):console;return new tn(async function*(){if(r)throw new eR("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of ti(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new eM(void 0,eB(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(ex(e))return;throw e}finally{s||t.abort()}},t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new e6;for await(let s of e0(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tn(async function*(){if(r)throw new eR("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ex(e))return;throw e}finally{e||t.abort()}},t,s)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new tn(()=>r(e),this.controller,ev(this,i,"f")),new tn(()=>r(t),this.controller,ev(this,i,"f"))]}toReadableStream(){let e;let t=this;return eY({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=e4(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*ti(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eR("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eR("Attempted to iterate over a response with no body")}let s=new to,r=new e6;for await(let t of ta(e0(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*ta(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?e4(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class to{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,r]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),":",e.substring(s+t.length)]:[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function tl(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(ts(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):tn.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){if("0"===s.headers.get("content-length"))return;return th(await s.json(),s)}return await s.text()})();return ts(e).debug(`[${r}] response parsed`,tr({retryOfRequestLogID:n,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function th(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class tu extends Promise{constructor(e,t,s=tl){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,a.set(this,void 0),e_(this,a,e,"f")}_thenUnwrap(e){return new tu(ev(this,a,"f"),this.responsePromise,async(t,s)=>th(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(ev(this,a,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}a=new WeakMap;class tc{constructor(e,t,s,r){o.set(this,void 0),e_(this,o,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eR("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ev(this,o,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(o=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class td extends tu{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tl(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tp extends tc{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...eF(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...eF(this.options.query),after_id:e}}:null}}class tf extends tc{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...eF(this.options.query),page:e}}:null}}let tm=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tg(e,t,s){return tm(),new File(e,t??"unknown_file",s)}function ty(e,t){let s="object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"";return t?s.split(/[\\/]/).pop()||void 0:s}let tb=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tw=async(e,t,s=!0)=>({...e,body:await tv(e.body,t,s)}),t_=new WeakMap,tv=async(e,t,s=!0)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=t_.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return t_.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tR(r,e,t,s))),r},tk=e=>e instanceof Blob&&"name"in e,tx=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tb(e)||tk(e)),tS=e=>{if(tx(e))return!0;if(Array.isArray(e))return e.some(tS);if(e&&"object"==typeof e){for(let t in e)if(tS(e[t]))return!0}return!1},tR=async(e,t,s,r)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let n={},i=s.headers.get("Content-Type");i&&(n={type:i}),e.append(t,tg([await s.blob()],ty(s,r),n))}else if(tb(s))e.append(t,tg([await new Response(eZ(s)).blob()],ty(s,r)));else if(tk(s))e.append(t,tg([s],ty(s,r),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>tR(e,t+"[]",s,r)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tR(e,`${t}[${s}]`,n,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tM=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tP=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tM(e),t$=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function tT(e,t,s){if(tm(),e=await e,t||(t=ty(e,!0)),tP(e))return e instanceof File&&null==t&&null==s?e:tg([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(t$(e)){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tg(await tA(r),t,s)}let r=await tA(e);if(!s?.type){let e=r.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tg(r,t,s)}async function tA(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tM(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tb(e))for await(let s of e)t.push(...await tA(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tO{constructor(e){this._client=e}}let tj=Symbol.for("brand.privateNullableHeaders"),tE=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,i]of function*(e){let t;if(!e)return;if(tj in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eD(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eD(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===i?(t.delete(n),s.add(r)):(t.append(n,i),s.delete(r))}}return{[tj]:!0,values:t,nulls:s}},tI=Symbol("anthropic.sdk.stainlessHelper");function tq(e){return"object"==typeof e&&null!==e&&tI in e}function tW(e,t){let s=new Set;if(e)for(let t of e)tq(t)&&s.add(t[tI]);if(t){for(let e of t)if(tq(e)&&s.add(e[tI]),Array.isArray(e.content))for(let t of e.content)tq(t)&&s.add(t[tI])}return Array.from(s)}function tN(e,t){let s=tW(e,t);return 0===s.length?{}:{"x-stainless-helper":s.join(", ")}}function tL(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tU=Object.freeze(Object.create(null)),tC=((e=tL)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,i=[],a=t.reduce((t,r,a)=>{/[?#]/.test(r)&&(n=!0);let o=s[a],l=(n?encodeURIComponent:e)(""+o);return a!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tU)??tU)?.toString)&&(l=o+"",i.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(a===s.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((e,t)=>e.start-t.start),i.length>0){let e=0,t=i.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new eR(`Path parameters result in path with invalid segments:
${i.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(tL);class tD extends tO{list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",tp,{query:r,...t,headers:tE([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/files/${e}`,{...s,headers:tE([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/files/${e}/content`,{...s,headers:tE([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/files/${e}`,{...s,headers:tE([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){var s;let{betas:r,...n}=e;return this._client.post("/v1/files",tw({body:n,...t,headers:tE([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},tq(s=n.file)?{"x-stainless-helper":s[tI]}:{},t?.headers])},this._client))}}class tF extends tO{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/models/${e}?beta=true`,{...s,headers:tE([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",tp,{query:r,...t,headers:tE([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tX={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tB(e){return e?.output_format??e?.output_config?.format}function tH(e,t,s){let r=tB(t);return t&&"parse"in(r??{})?tJ(e,t,s):{...e,content:e.content.map(e=>"text"===e.type?Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:null,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null),enumerable:!1}):e),parsed_output:null}}function tJ(e,t,s){let r=null,n=e.content.map(e=>{if("text"===e.type){let n=function(e,t){let s=tB(e);if(s?.type!=="json_schema")return null;try{if("parse"in s)return s.parse(t);return JSON.parse(t)}catch(e){throw new eR(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===r&&(r=n),Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:n,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),n),enumerable:!1})}return e});return{...e,content:n,parsed_output:r}}let tK=e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",i=!1;for(r=e[++t];'"'!==r;){if(t===e.length){i=!0;break}if("\\"===r){if(++t===e.length){i=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],i||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let i=/[0-9]/;if(r&&i.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&i.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let a=/[a-z]/i;if(r&&a.test(r)){let n="";for(;r&&a.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s},tV=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tV(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return tV(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return tV(e=e.slice(0,e.length-1));break;case"delimiter":return tV(e=e.slice(0,e.length-1))}return e},tz=e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e},tQ=e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t},tG=e=>JSON.parse(tQ(tz(tV(tK(e))))),tY="__json_buf";function tZ(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class t0{constructor(e,t){l.add(this),this.messages=[],this.receivedMessages=[],h.set(this,void 0),u.set(this,null),this.controller=new AbortController,c.set(this,void 0),d.set(this,()=>{}),p.set(this,()=>{}),f.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),b.set(this,!1),w.set(this,!1),_.set(this,!1),v.set(this,!1),k.set(this,void 0),x.set(this,void 0),S.set(this,void 0),P.set(this,e=>{if(e_(this,w,!0,"f"),ex(e)&&(e=new eP),e instanceof eP)return e_(this,_,!0,"f"),this._emit("abort",e);if(e instanceof eR)return this._emit("error",e);if(e instanceof Error){let t=new eR(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eR(String(e)))}),e_(this,c,new Promise((e,t)=>{e_(this,d,e,"f"),e_(this,p,t,"f")}),"f"),e_(this,f,new Promise((e,t)=>{e_(this,m,e,"f"),e_(this,g,t,"f")}),"f"),ev(this,c,"f").catch(()=>{}),ev(this,f,"f").catch(()=>{}),e_(this,u,e,"f"),e_(this,S,t?.logger??console,"f")}get response(){return ev(this,k,"f")}get request_id(){return ev(this,x,"f")}async withResponse(){e_(this,v,!0,"f");let e=await ev(this,c,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new t0(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:r}={}){let n=new t0(t,{logger:r});for(let e of t.messages)n._addMessageParam(e);return e_(n,u,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ev(this,P,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ev(this,l,"m",$).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ev(this,l,"m",T).call(this,e);if(n.controller.signal?.aborted)throw new eP;ev(this,l,"m",A).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(e_(this,k,e,"f"),e_(this,x,e?.headers.get("request-id"),"f"),ev(this,d,"f").call(this,e),this._emit("connect"))}get ended(){return ev(this,b,"f")}get errored(){return ev(this,w,"f")}get aborted(){return ev(this,_,"f")}abort(){this.controller.abort()}on(e,t){return(ev(this,y,"f")[e]||(ev(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ev(this,y,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ev(this,y,"f")[e]||(ev(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{e_(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){e_(this,v,!0,"f"),await ev(this,f,"f")}get currentMessage(){return ev(this,h,"f")}async finalMessage(){return await this.done(),ev(this,l,"m",R).call(this)}async finalText(){return await this.done(),ev(this,l,"m",M).call(this)}_emit(e,...t){if(ev(this,b,"f"))return;"end"===e&&(e_(this,b,!0,"f"),ev(this,m,"f").call(this));let s=ev(this,y,"f")[e];if(s&&(ev(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ev(this,v,"f")||s?.length||Promise.reject(e),ev(this,p,"f").call(this,e),ev(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ev(this,v,"f")||s?.length||Promise.reject(e),ev(this,p,"f").call(this,e),ev(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ev(this,l,"m",R).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ev(this,l,"m",$).call(this),this._connected(null);let t=tn.fromReadableStream(e,this.controller);for await(let e of t)ev(this,l,"m",T).call(this,e);if(t.controller.signal?.aborted)throw new eP;ev(this,l,"m",A).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,_=new WeakMap,v=new WeakMap,k=new WeakMap,x=new WeakMap,S=new WeakMap,P=new WeakMap,l=new WeakSet,R=function(){if(0===this.receivedMessages.length)throw new eR("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},M=function(){if(0===this.receivedMessages.length)throw new eR("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new eR("stream ended without producing a content block with type=text");return e.join(" ")},$=function(){this.ended||e_(this,h,void 0,"f")},T=function(e){if(this.ended)return;let t=ev(this,l,"m",O).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tZ(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;case"compaction_delta":"compaction"===s.type&&s.content&&this._emit("compaction",s.content);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(tH(t,ev(this,u,"f"),{logger:ev(this,S,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":e_(this,h,t,"f")}},A=function(){if(this.ended)throw new eR("stream has ended, this shouldn't happen");let e=ev(this,h,"f");if(!e)throw new eR("request ended without sending any chunks");return e_(this,h,void 0,"f"),tH(e,ev(this,u,"f"),{logger:ev(this,S,"f")})},O=function(e){let t=ev(this,h,"f");if("message_start"===e.type){if(t)throw new eR(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new eR(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),null!=e.usage.iterations&&(t.usage.iterations=e.usage.iterations),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tZ(s)){let r=s[tY]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,tY,{value:r,enumerable:!1,writable:!0}),r)try{n.input=tG(r)}catch(t){let e=new eR(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);ev(this,P,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;case"compaction_delta":s?.type==="compaction"&&(t.content[e.index]={...s,content:(s.content||"")+e.delta.content});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class t1 extends Error{constructor(e){super("string"==typeof e?e:e.map(e=>"text"===e.type?e.text:`[${e.type}]`).join(" ")),this.name="ToolError",this.content=e}}let t2=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function t4(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class t5{constructor(e,t,s){j.add(this),this.client=e,E.set(this,!1),I.set(this,!1),q.set(this,void 0),W.set(this,void 0),N.set(this,void 0),L.set(this,void 0),U.set(this,void 0),C.set(this,0),e_(this,q,{params:{...t,messages:structuredClone(t.messages)}},"f");let r=["BetaToolRunner",...tW(t.tools,t.messages)].join(", ");e_(this,W,{...s,headers:tE([{"x-stainless-helper":r},s?.headers])},"f"),e_(this,U,t4(),"f")}async *[(E=new WeakMap,I=new WeakMap,q=new WeakMap,W=new WeakMap,N=new WeakMap,L=new WeakMap,U=new WeakMap,C=new WeakMap,j=new WeakSet,D=async function(){let e=ev(this,q,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==ev(this,N,"f"))try{let e=await ev(this,N,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??ev(this,q,"f").params.model,r=e.summaryPrompt??t2,n=ev(this,q,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let i=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:ev(this,q,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(i.content[0]?.type!=="text")throw new eR("Expected text response for compaction");return ev(this,q,"f").params.messages=[{role:"user",content:i.content}],!0},Symbol.asyncIterator)](){var e;if(ev(this,E,"f"))throw new eR("Cannot iterate over a consumed stream");e_(this,E,!0,"f"),e_(this,I,!0,"f"),e_(this,L,void 0,"f");try{for(;;){let t;try{if(ev(this,q,"f").params.max_iterations&&ev(this,C,"f")>=ev(this,q,"f").params.max_iterations)break;e_(this,I,!1,"f"),e_(this,L,void 0,"f"),e_(this,C,(e=ev(this,C,"f"),++e),"f"),e_(this,N,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=ev(this,q,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},ev(this,W,"f")),e_(this,N,t.finalMessage(),"f"),ev(this,N,"f").catch(()=>{}),yield t):(e_(this,N,this.client.beta.messages.create({...n,stream:!1},ev(this,W,"f")),"f"),yield ev(this,N,"f")),!await ev(this,j,"m",D).call(this)){if(!ev(this,I,"f")){let{role:e,content:t}=await ev(this,N,"f");ev(this,q,"f").params.messages.push({role:e,content:t})}let e=await ev(this,j,"m",F).call(this,ev(this,q,"f").params.messages.at(-1));if(e)ev(this,q,"f").params.messages.push(e);else if(!ev(this,I,"f"))break}}finally{t&&t.abort()}}if(!ev(this,N,"f"))throw new eR("ToolRunner concluded without a message from the server");ev(this,U,"f").resolve(await ev(this,N,"f"))}catch(e){throw e_(this,E,!1,"f"),ev(this,U,"f").promise.catch(()=>{}),ev(this,U,"f").reject(e),e_(this,U,t4(),"f"),e}}setMessagesParams(e){"function"==typeof e?ev(this,q,"f").params=e(ev(this,q,"f").params):ev(this,q,"f").params=e,e_(this,I,!0,"f"),e_(this,L,void 0,"f")}async generateToolResponse(){let e=await ev(this,N,"f")??this.params.messages.at(-1);return e?ev(this,j,"m",F).call(this,e):null}done(){return ev(this,U,"f").promise}async runUntilDone(){if(!ev(this,E,"f"))for await(let e of this);return this.done()}get params(){return ev(this,q,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function t6(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:e instanceof t1?e.content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}F=async function(e){return void 0!==ev(this,L,"f")||e_(this,L,t6(ev(this,q,"f").params,e),"f"),ev(this,L,"f")};class t3{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new e6;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eR("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eR("Attempted to iterate over a response with no body")}return new t3(e0(e.body),t)}}class t9 extends tO{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:tE([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/messages/batches/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",tp,{query:r,...t,headers:tE([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/messages/batches/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(tC`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:tE([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new eR(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:tE([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>t3.fromResponse(t.response,t.controller))}}let t8={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"},t7=["claude-opus-4-6"];class se extends tO{constructor(){super(...arguments),this.batches=new t9(this._client)}create(e,t){let s=st(e),{betas:r,...n}=s;n.model in t8&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${t8[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),n.model in t7&&n.thinking&&"enabled"===n.thinking.type&&console.warn(`Using Claude with ${n.model} and 'thinking.type=enabled' is deprecated. Use 'thinking.type=adaptive' instead which results in better model performance in our testing: https://platform.claude.com/docs/en/build-with-claude/adaptive-thinking`);let i=this._client._options.timeout;if(!n.stream&&null==i){let e=tX[n.model]??void 0;i=this._client.calculateNonstreamingTimeout(n.max_tokens,e)}let a=tN(n.tools,n.messages);return this._client.post("/v1/messages?beta=true",{body:n,timeout:i??6e5,...t,headers:tE([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},a,t?.headers]),stream:s.stream??!1})}parse(e,t){return t={...t,headers:tE([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-12-15"].toString()},t?.headers])},this.create(e,t).then(t=>tJ(t,e,{logger:this._client.logger??console}))}stream(e,t){return t0.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=st(e);return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:tE([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new t5(this._client,e,t)}}function st(e){if(!e.output_format)return e;if(e.output_config?.format)throw new eR("Both output_format and output_config.format were provided. Please use only output_config.format (output_format is deprecated).");let{output_format:t,...s}=e;return{...s,output_config:{...e.output_config,format:t}}}se.Batches=t9,se.BetaToolRunner=t5,se.ToolError=t1;class ss extends tO{create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(tC`/v1/skills/${e}/versions?beta=true`,tw({body:n,...s,headers:tE([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(tC`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(tC`/v1/skills/${e}/versions?beta=true`,tf,{query:n,...s,headers:tE([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(tC`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class sr extends tO{constructor(){super(...arguments),this.versions=new ss(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",tw({body:r,...t,headers:tE([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client,!1))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/skills/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",tf,{query:r,...t,headers:tE([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(tC`/v1/skills/${e}?beta=true`,{...s,headers:tE([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}sr.Versions=ss;class sn extends tO{constructor(){super(...arguments),this.models=new tF(this._client),this.messages=new se(this._client),this.files=new tD(this._client),this.skills=new sr(this._client)}}sn.Models=tF,sn.Messages=se,sn.Files=tD,sn.Skills=sr;class si extends tO{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:tE([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}function sa(e){return e?.output_config?.format}function so(e,t,s){let r=sa(t);return t&&"parse"in(r??{})?sl(e,t,s):{...e,content:e.content.map(e=>"text"===e.type?Object.defineProperty({...e},"parsed_output",{value:null,enumerable:!1}):e),parsed_output:null}}function sl(e,t,s){let r=null,n=e.content.map(e=>{if("text"===e.type){let s=function(e,t){let s=sa(e);if(s?.type!=="json_schema")return null;try{if("parse"in s)return s.parse(t);return JSON.parse(t)}catch(e){throw new eR(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===r&&(r=s),Object.defineProperty({...e},"parsed_output",{value:s,enumerable:!1})}return e});return{...e,content:n,parsed_output:r}}let sh="__json_buf";function su(e){return"tool_use"===e.type||"server_tool_use"===e.type}class sc{constructor(e,t){X.add(this),this.messages=[],this.receivedMessages=[],B.set(this,void 0),H.set(this,null),this.controller=new AbortController,J.set(this,void 0),K.set(this,()=>{}),V.set(this,()=>{}),z.set(this,void 0),Q.set(this,()=>{}),G.set(this,()=>{}),Y.set(this,{}),Z.set(this,!1),ee.set(this,!1),et.set(this,!1),es.set(this,!1),er.set(this,void 0),en.set(this,void 0),ei.set(this,void 0),el.set(this,e=>{if(e_(this,ee,!0,"f"),ex(e)&&(e=new eP),e instanceof eP)return e_(this,et,!0,"f"),this._emit("abort",e);if(e instanceof eR)return this._emit("error",e);if(e instanceof Error){let t=new eR(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eR(String(e)))}),e_(this,J,new Promise((e,t)=>{e_(this,K,e,"f"),e_(this,V,t,"f")}),"f"),e_(this,z,new Promise((e,t)=>{e_(this,Q,e,"f"),e_(this,G,t,"f")}),"f"),ev(this,J,"f").catch(()=>{}),ev(this,z,"f").catch(()=>{}),e_(this,H,e,"f"),e_(this,ei,t?.logger??console,"f")}get response(){return ev(this,er,"f")}get request_id(){return ev(this,en,"f")}async withResponse(){e_(this,es,!0,"f");let e=await ev(this,J,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new sc(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:r}={}){let n=new sc(t,{logger:r});for(let e of t.messages)n._addMessageParam(e);return e_(n,H,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ev(this,el,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ev(this,X,"m",eh).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ev(this,X,"m",eu).call(this,e);if(n.controller.signal?.aborted)throw new eP;ev(this,X,"m",ec).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(e_(this,er,e,"f"),e_(this,en,e?.headers.get("request-id"),"f"),ev(this,K,"f").call(this,e),this._emit("connect"))}get ended(){return ev(this,Z,"f")}get errored(){return ev(this,ee,"f")}get aborted(){return ev(this,et,"f")}abort(){this.controller.abort()}on(e,t){return(ev(this,Y,"f")[e]||(ev(this,Y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ev(this,Y,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ev(this,Y,"f")[e]||(ev(this,Y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{e_(this,es,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){e_(this,es,!0,"f"),await ev(this,z,"f")}get currentMessage(){return ev(this,B,"f")}async finalMessage(){return await this.done(),ev(this,X,"m",ea).call(this)}async finalText(){return await this.done(),ev(this,X,"m",eo).call(this)}_emit(e,...t){if(ev(this,Z,"f"))return;"end"===e&&(e_(this,Z,!0,"f"),ev(this,Q,"f").call(this));let s=ev(this,Y,"f")[e];if(s&&(ev(this,Y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ev(this,es,"f")||s?.length||Promise.reject(e),ev(this,V,"f").call(this,e),ev(this,G,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ev(this,es,"f")||s?.length||Promise.reject(e),ev(this,V,"f").call(this,e),ev(this,G,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ev(this,X,"m",ea).call(this))}async _fromReadableStream(e,t){let s;let r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ev(this,X,"m",eh).call(this),this._connected(null);let t=tn.fromReadableStream(e,this.controller);for await(let e of t)ev(this,X,"m",eu).call(this,e);if(t.controller.signal?.aborted)throw new eP;ev(this,X,"m",ec).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(B=new WeakMap,H=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,z=new WeakMap,Q=new WeakMap,G=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,er=new WeakMap,en=new WeakMap,ei=new WeakMap,el=new WeakMap,X=new WeakSet,ea=function(){if(0===this.receivedMessages.length)throw new eR("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},eo=function(){if(0===this.receivedMessages.length)throw new eR("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new eR("stream ended without producing a content block with type=text");return e.join(" ")},eh=function(){this.ended||e_(this,B,void 0,"f")},eu=function(e){if(this.ended)return;let t=ev(this,X,"m",ed).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":su(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:e.delta}break}case"message_stop":this._addMessageParam(t),this._addMessage(so(t,ev(this,H,"f"),{logger:ev(this,ei,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":e_(this,B,t,"f")}},ec=function(){if(this.ended)throw new eR("stream has ended, this shouldn't happen");let e=ev(this,B,"f");if(!e)throw new eR("request ended without sending any chunks");return e_(this,B,void 0,"f"),so(e,ev(this,H,"f"),{logger:ev(this,ei,"f")})},ed=function(e){let t=ev(this,B,"f");if("message_start"===e.type){if(t)throw new eR(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new eR(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&su(s)){let r=s[sh]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,sh,{value:r,enumerable:!1,writable:!0}),r&&(n.input=tG(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:e.delta}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class sd extends tO{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tC`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",tp,{query:e,...t})}delete(e,t){return this._client.delete(tC`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(tC`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new eR(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:tE([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>t3.fromResponse(t.response,t.controller))}}class sp extends tO{constructor(){super(...arguments),this.batches=new sd(this._client)}create(e,t){e.model in sf&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${sf[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),e.model in sm&&e.thinking&&"enabled"===e.thinking.type&&console.warn(`Using Claude with ${e.model} and 'thinking.type=enabled' is deprecated. Use 'thinking.type=adaptive' instead which results in better model performance in our testing: https://platform.claude.com/docs/en/build-with-claude/adaptive-thinking`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=tX[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}let r=tN(e.tools,e.messages);return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,headers:tE([r,t?.headers]),stream:e.stream??!1})}parse(e,t){return this.create(e,t).then(t=>sl(t,e,{logger:this._client.logger??console}))}stream(e,t){return sc.createMessage(this,e,t,{logger:this._client.logger??console})}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let sf={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026","claude-3-5-haiku-latest":"February 19th, 2026","claude-3-5-haiku-20241022":"February 19th, 2026"},sm=["claude-opus-4-6"];sp.Batches=sd;class sg extends tO{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(tC`/v1/models/${e}`,{...s,headers:tE([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",tp,{query:r,...t,headers:tE([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let sy=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sb{constructor({baseURL:e=sy("ANTHROPIC_BASE_URL"),apiKey:t=sy("ANTHROPIC_API_KEY")??null,authToken:s=sy("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){ep.add(this),em.set(this,void 0);let n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};if(!n.dangerouslyAllowBrowser&&eK())throw new eR("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=n.baseURL,this.timeout=n.timeout??ef.DEFAULT_TIMEOUT,this.logger=n.logger??console;let i="warn";this.logLevel=i,this.logLevel=e9(n.logLevel,"ClientOptions.logLevel",this)??e9(sy("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),e_(this,em,e2,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization")||t.has("authorization")))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return tE([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return tE([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return tE([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new eR(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${eJ}`}defaultIdempotencyKey(){return`stainless-node-retry-${ek()}`}makeStatusError(e,t,s,r){return eM.generate(e,t,s,r)}buildURL(e,t,s){let r=!ev(this,ep,"m",eg).call(this)&&s||this.baseURL,n=new URL(eU(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new eR("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tu(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),h=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(ts(this).debug(`[${l}] sending request`,tr({retryOfRequestLogID:s,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new eP;let c=new AbortController,d=await this.fetchWithTimeout(a,i,o,c).catch(eS),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new eP;let n=ex(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return ts(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),ts(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,tr({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),this.retryRequest(r,t,s??l);if(ts(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),ts(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,tr({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),n)throw new eT;throw new e$({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${h}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await e1(d.body),ts(this).info(`${m} - ${e}`),ts(this).debug(`[${l}] response error (${e})`,tr({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";ts(this).info(`${m} - ${n}`);let i=await d.text().catch(e=>eS(e).message),a=eB(i),o=a?void 0:i;throw ts(this).debug(`[${l}] response error (${n})`,tr({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return ts(this).info(m),ts(this).debug(`[${l}] response start`,tr({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:r,controller:c,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,s&&"then"in s?s.then(t=>({method:"get",path:e,...t})):{method:"get",path:e,...s})}requestAPIList(e,t){return new td(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:i,...a}=t||{},o=this._makeAbort(r);n&&n.addEventListener("abort",o,{once:!0});let l=setTimeout(o,s),h=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,u={signal:r.signal,...h?{duplex:"half"}:{},method:"GET",...a};i&&(u.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(l)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,r){let n;let i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let a=r?.get("retry-after");if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await eH(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new eR("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:i,defaultBaseURL:a}=s,o=this.buildURL(n,i,a);"timeout"in s&&eX("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:h}=this.buildBody({options:s}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let i=tE([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...eG(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=tE([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:eZ(e)}:"object"==typeof e&&"application/x-www-form-urlencoded"===s.values.get("content-type")?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(e)}:ev(this,em,"f").call(this,{body:e,headers:s})}}ef=sb,em=new WeakMap,ep=new WeakSet,eg=function(){return"https://api.anthropic.com"!==this.baseURL},sb.Anthropic=ef,sb.HUMAN_PROMPT="\\n\\nHuman:",sb.AI_PROMPT="\\n\\nAssistant:",sb.DEFAULT_TIMEOUT=6e5,sb.AnthropicError=eR,sb.APIError=eM,sb.APIConnectionError=e$,sb.APIConnectionTimeoutError=eT,sb.APIUserAbortError=eP,sb.NotFoundError=eE,sb.ConflictError=eI,sb.RateLimitError=eW,sb.BadRequestError=eA,sb.AuthenticationError=eO,sb.InternalServerError=eN,sb.PermissionDeniedError=ej,sb.UnprocessableEntityError=eq,sb.toFile=tT;class sw extends sb{constructor(){super(...arguments),this.completions=new si(this),this.messages=new sp(this),this.models=new sg(this),this.beta=new sn(this)}}sw.Completions=si,sw.Messages=sp,sw.Models=sg,sw.Beta=sn}};